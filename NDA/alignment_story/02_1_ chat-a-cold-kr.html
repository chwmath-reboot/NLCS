<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S-Engine ì‘ê¸‰ì‹¤ ì¸í„´ ì‹œë®¬ë ˆì´í„° v1.0</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      min-height: 100vh;
      background: linear-gradient(180deg, #1a2a3a 0%, #0d1a26 100%);
      color: #e0e0e0;
      font-family: 'Noto Sans KR', sans-serif;
      padding: 15px;
      font-size: 14px;
    }
    
    .container { max-width: 800px; margin: 0 auto; }
    
    header { text-align: center; margin-bottom: 15px; }
    
    h1 {
      font-size: 1.6rem;
      color: #4ecdc4;
      margin-bottom: 5px;
    }
    
    .subtitle { color: #888; font-size: 0.8rem; }
    
    .credit { 
      color: #ffd700; 
      font-size: 0.75rem; 
      margin-top: 5px;
      font-style: italic;
    }
    
    /* ê³¨ë“œ í‘œì‹œ */
    .gold-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0,0,0,0.3);
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border: 1px solid rgba(255,215,0,0.3);
    }
    
    .gold-total {
      font-size: 1.2rem;
      color: #ffd700;
      font-weight: bold;
    }
    
    .gold-change {
      font-size: 0.9rem;
      padding: 3px 8px;
      border-radius: 4px;
    }
    
    .gold-change.positive { background: rgba(46,204,113,0.2); color: #2ecc71; }
    .gold-change.negative { background: rgba(231,76,60,0.2); color: #e74c3c; }
    .gold-change.neutral { background: rgba(255,255,255,0.1); color: #888; }
    
    /* ëŒ€í™”ì°½ */
    .dialog-box {
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      min-height: 200px;
      max-height: 350px;
      overflow-y: auto;
    }
    
    .dialog-line {
      margin-bottom: 12px;
      padding: 8px 12px;
      border-radius: 8px;
      line-height: 1.5;
    }
    
    .dialog-line.nurse {
      background: rgba(155,89,182,0.2);
      border-left: 3px solid #9b59b6;
    }
    
    .dialog-line.intern {
      background: rgba(52,152,219,0.2);
      border-left: 3px solid #3498db;
    }
    
    .dialog-line.patient {
      background: rgba(230,126,34,0.2);
      border-left: 3px solid #e67e22;
    }
    
    .dialog-line.system {
      background: rgba(46,204,113,0.2);
      border-left: 3px solid #2ecc71;
      font-style: italic;
    }
    
    .dialog-line.result {
      background: rgba(255,215,0,0.15);
      border-left: 3px solid #ffd700;
      font-weight: bold;
    }
    
    .speaker {
      font-weight: bold;
      margin-right: 8px;
    }
    
    .speaker.nurse { color: #9b59b6; }
    .speaker.intern { color: #3498db; }
    .speaker.patient { color: #e67e22; }
    
    /* ì°¨íŠ¸ì°½ */
    .chart-box {
      background: rgba(255,255,255,0.95);
      color: #333;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      font-family: 'Courier New', monospace;
    }
    
    .chart-title {
      font-weight: bold;
      font-size: 1rem;
      border-bottom: 2px solid #333;
      padding-bottom: 8px;
      margin-bottom: 10px;
      text-align: center;
    }
    
    .chart-row {
      display: flex;
      margin-bottom: 5px;
    }
    
    .chart-label {
      font-weight: bold;
      min-width: 80px;
    }
    
    .chart-value {
      flex: 1;
    }
    
    .chart-symptoms {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .symptom-tag {
      background: #e74c3c;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.85rem;
    }
    
    /* ë²„íŠ¼ ì˜ì—­ */
    .button-area {
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .button-title {
      color: #4ecdc4;
      font-size: 0.85rem;
      margin-bottom: 10px;
    }
    
    .symptom-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    
    .symptom-btn {
      padding: 8px 14px;
      background: rgba(52,152,219,0.3);
      border: 1px solid rgba(52,152,219,0.5);
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
    }
    
    .symptom-btn:hover {
      background: rgba(52,152,219,0.5);
      transform: translateY(-1px);
    }
    
    .symptom-btn.selected {
      background: rgba(46,204,113,0.4);
      border-color: #2ecc71;
    }
    
    .symptom-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 15px;
    }
    
    .action-btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .action-btn.primary {
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white;
    }
    
    .action-btn.secondary {
      background: linear-gradient(135deg, #9b59b6, #8e44ad);
      color: white;
    }
    
    .action-btn.success {
      background: linear-gradient(135deg, #2ecc71, #27ae60);
      color: white;
    }
    
    .action-btn.danger {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
    }
    
    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    
    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    /* ì§„ë‹¨ ë²„íŠ¼ */
    .diagnosis-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 15px;
    }
    
    .diagnosis-btn {
      padding: 15px 40px;
      border: 2px solid;
      border-radius: 10px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .diagnosis-btn.cold {
      background: rgba(46,204,113,0.2);
      border-color: #2ecc71;
      color: #2ecc71;
    }
    
    .diagnosis-btn.report {
      background: rgba(231,76,60,0.2);
      border-color: #e74c3c;
      color: #e74c3c;
    }
    
    .diagnosis-btn:hover {
      transform: scale(1.05);
    }
    
    /* í†µê³„ */
    .stats-bar {
      display: flex;
      justify-content: space-around;
      background: rgba(0,0,0,0.3);
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 0.85rem;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-value {
      font-size: 1.2rem;
      font-weight: bold;
      color: #4ecdc4;
    }
    
    .stat-label {
      color: #888;
    }
    
    /* ìŠ¤í¬ë¡¤ë°” */
    .dialog-box::-webkit-scrollbar { width: 6px; }
    .dialog-box::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
    .dialog-box::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
    
    /* í…ŒìŠ¤íŠ¸ íŒ¨ë„ */
    .test-panel {
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,165,0,0.3);
      border-radius: 8px;
      margin-top: 15px;
      overflow: hidden;
    }
    
    .test-title {
      padding: 10px 15px;
      background: rgba(255,165,0,0.15);
      color: #ffa500;
      font-size: 0.85rem;
      cursor: pointer;
    }
    
    .test-content {
      padding: 15px;
    }
    
    .test-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }
    
    .test-row label {
      min-width: 80px;
      color: #aaa;
    }
    
    .test-row input {
      width: 80px;
      padding: 5px 8px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 4px;
      color: #fff;
      font-size: 0.9rem;
    }
    
    /* ì—”ë”© í™”ë©´ */
    .ending-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .ending-content {
      text-align: center;
      padding: 40px;
      background: linear-gradient(135deg, rgba(46,204,113,0.2), rgba(39,174,96,0.1));
      border: 2px solid #2ecc71;
      border-radius: 20px;
      max-width: 400px;
    }
    
    .ending-screen.fail .ending-content {
      background: linear-gradient(135deg, rgba(231,76,60,0.2), rgba(192,57,43,0.1));
      border-color: #e74c3c;
    }
    
    .ending-screen.bankrupt .ending-content {
      background: linear-gradient(135deg, rgba(127,140,141,0.2), rgba(95,106,106,0.1));
      border-color: #7f8c8d;
    }
    
    .ending-icon {
      font-size: 4rem;
      margin-bottom: 20px;
    }
    
    .ending-title {
      font-size: 1.8rem;
      font-weight: bold;
      color: #2ecc71;
      margin-bottom: 15px;
    }
    
    .ending-screen.fail .ending-title {
      color: #e74c3c;
    }
    
    .ending-screen.bankrupt .ending-title {
      color: #7f8c8d;
    }
    
    .ending-text {
      font-size: 1.1rem;
      color: #ccc;
      line-height: 1.6;
      margin-bottom: 20px;
    }
    
    .ending-text strong {
      color: #4ecdc4;
      font-size: 1.3rem;
    }
    
    .ending-stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      font-size: 0.95rem;
      color: #aaa;
    }
    
    .ending-stats strong {
      color: #ffd700;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ¥ ì‘ê¸‰ì‹¤ ì¸í„´ ì‹œë®¬ë ˆì´í„°</h1>
      <div class="subtitle">S-Engine ì˜ë£Œ ë„ë©”ì¸ í™•ì¥íŒ© v1.0 | ê²½ì§€: ì´ë¥˜(ì¸í„´)</div>
      <div class="credit">S-Engineìœ¼ë¡œ NLPgí–ˆê³ , Claudeê°€ ì½”ë”©í–ˆë‹¤.</div>
    </header>
    
    <!-- ê³¨ë“œ ë°” -->
    <div class="gold-bar">
      <div class="gold-total">ğŸ’° <span id="gold-total">0</span> Gold</div>
      <div id="gold-change" class="gold-change neutral">ìµœê·¼ ë³€ë™ ì—†ìŒ</div>
    </div>
    
    <!-- í†µê³„ -->
    <div class="stats-bar">
      <div class="stat-item">
        <div class="stat-value" id="stat-patients">0</div>
        <div class="stat-label">ì§„ë£Œ í™˜ì</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="stat-correct">0</div>
        <div class="stat-label">ì •í™• ì§„ë‹¨</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="stat-missed">0</div>
        <div class="stat-label">ì˜¤ì§„</div>
      </div>
    </div>
    
    <!-- ëŒ€í™”ì°½ -->
    <div class="dialog-box" id="dialog-box">
      <div class="dialog-line system">
        <span>ğŸ‘©â€âš•ï¸ ì‘ê¸‰ì‹¤ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤, ê¹€ ì„ ìƒë‹˜.</span>
      </div>
    </div>
    
    <!-- ì°¨íŠ¸ì°½ -->
    <div class="chart-box">
      <div class="chart-title">ğŸ“‹ í™˜ì ì°¨íŠ¸</div>
      <div class="chart-row">
        <span class="chart-label">ì²´ì˜¨:</span>
        <span class="chart-value" id="chart-temp">-</span>
      </div>
      <div class="chart-row">
        <span class="chart-label">ì¦ìƒ:</span>
        <div class="chart-symptoms" id="chart-symptoms">
          <span style="color:#888;">-</span>
        </div>
      </div>
    </div>
    
    <!-- ë²„íŠ¼ ì˜ì—­ -->
    <div class="button-area" id="button-area">
      <div style="text-align: center; margin-bottom: 15px; color: #4ecdc4; font-size: 1rem;">
        ğŸ¯ 100ëª…ì˜ í™˜ì ì¤‘ì—ì„œ 95ëª… ì´ìƒì„ ì§„ë‹¨í•˜ëŠ” ëª…í’ˆ ì¸í„´ì— ë„ì „í•˜ì„¸ìš”!
      </div>
      <div class="action-buttons">
        <button class="action-btn primary" id="btn-start" onclick="startNewPatient()">
          ğŸ©º ë‹¤ìŒ í™˜ì ë°›ê¸°
        </button>
      </div>
    </div>
    
    <!-- í…ŒìŠ¤íŠ¸ ì¡°ì ˆ íƒ­ -->
    <div class="test-panel" id="test-panel">
      <div class="test-title" onclick="toggleTestPanel()">ğŸ”§ í…ŒìŠ¤íŠ¸ ëª¨ë“œ (í´ë¦­í•˜ì—¬ ì—´ê¸°)</div>
      <div class="test-content" id="test-content" style="display: none;">
        <div class="test-row">
          <label>ì§„ë£Œ í™˜ì:</label>
          <input type="number" id="test-patients" value="0" min="0" max="100" onchange="updateTestStats()">
        </div>
        <div class="test-row">
          <label>ì •í™• ì§„ë‹¨:</label>
          <input type="number" id="test-correct" value="0" min="0" max="100" onchange="updateTestStats()">
        </div>
        <div class="test-row">
          <label>ì˜¤ì§„:</label>
          <input type="number" id="test-missed" value="0" min="0" max="100" onchange="updateTestStats()">
        </div>
        <button class="action-btn secondary" onclick="applyTestStats()" style="margin-top: 10px; padding: 8px 20px;">ì ìš©</button>
      </div>
    </div>
    
    <!-- ì—”ë”© í™”ë©´ -->
    <div class="ending-screen" id="ending-screen" style="display: none;">
      <div class="ending-content">
        <div class="ending-icon">ğŸ‰</div>
        <div class="ending-title">ì¶•í•˜í•©ë‹ˆë‹¤!</div>
        <div class="ending-text">ë‹¹ì‹ ì€ ì´ì œë¶€í„° ì¸í„´ì—ì„œ<br><strong>ë ˆì§€ë˜íŠ¸</strong>ë¡œ ìŠ¹ê²©ë˜ì—ˆìŠµë‹ˆë‹¤.</div>
        <div class="ending-stats">
          <span>ì§„ë£Œ: <strong id="ending-patients">100</strong>ëª…</span>
          <span>ì •í™•: <strong id="ending-correct">95</strong>ëª…</span>
          <span>ì •í™•ë„: <strong id="ending-rate">95%</strong></span>
        </div>
        <button class="action-btn success" onclick="continueGame()" style="margin-top: 20px;">ğŸ® ê²Œì„ ì´ì–´í•˜ê¸°</button>
      </div>
    </div>
    
    <!-- ì‹¤íŒ¨ ì—”ë”© í™”ë©´ -->
    <div class="ending-screen fail" id="fail-screen" style="display: none;">
      <div class="ending-content">
        <div class="ending-icon">ğŸ˜¢</div>
        <div class="ending-title">ì•„ì‰½ìŠµë‹ˆë‹¤...</div>
        <div class="ending-text">95ëª… ì´ìƒ ì •í™• ì§„ë‹¨ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!</div>
        <div class="ending-stats">
          <span>ì§„ë£Œ: <strong id="fail-patients">100</strong>ëª…</span>
          <span>ì •í™•: <strong id="fail-correct">90</strong>ëª…</span>
          <span>ì •í™•ë„: <strong id="fail-rate">90%</strong></span>
        </div>
        <button class="action-btn primary" onclick="restartGame()" style="margin-top: 20px;">ğŸ”„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
      </div>
    </div>
    
    <!-- ê°œë°œì‚¬ ë§í•¨ í™”ë©´ -->
    <div class="ending-screen bankrupt" id="bankrupt-screen" style="display: none;">
      <div class="ending-content">
        <div class="ending-icon">ğŸ’€</div>
        <div class="ending-title">ê°œë°œì‚¬ê°€ ë§í–ˆìŠµë‹ˆë‹¤.</div>
        <div class="ending-text">ë ˆì§€ë˜íŠ¸ ë²„ì „ì€ ì¶œì‹œê°€ ì–´ë µìŠµë‹ˆë‹¤.</div>
        <button class="action-btn danger" onclick="restartGame()" style="margin-top: 20px;">ğŸ”„ ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>
  </div>

  <script>
    // ===== ê²Œì„ ìƒíƒœ =====
    const state = {
      gold: 0,
      lastChange: 0,
      patients: 0,
      correct: 0,
      missed: 0,
      phase: 'idle', // idle, firstQuestion, secondQuestion, tempCheck, additionalQuestion, sinusitisCheck, diagnosis
      currentPatient: null,
      selectedSymptoms: [],
      sinusitisAnswers: []
    };
    
    // ===== ì¦ìƒ ë°ì´í„° =====
    const SYMPTOMS = {
      // ìƒê¸°ë„ ì¦ìƒ
      'ì½§ë¬¼': ['ì½§ë¬¼ì´ ë¬¼ì²˜ëŸ¼ ê³„ì† í˜ëŸ¬ìš”.', 'íœ´ì§€ë¥¼ ì•„ë¬´ë¦¬ ì¨ë„ ëì´ ì—†ì–´ìš”.', 'ìê¾¸ í›Œì©ê±°ë¦¬ê²Œ ë¼ì„œ ë„ˆë¬´ ë¶ˆí¸í•´ìš”.', 'ì½§ë¬¼ì´ ì¤„ì¤„ ë‚˜ì„œ ì¼ë„ ëª» í•˜ê² ì–´ìš”.', 'ê°ê¸° ê¸°ìš´ì¸ì§€ ì½§ë¬¼ì´ ê³„ì† ë–¨ì–´ì ¸ìš”.'],
      'ì½”ë§‰í˜': ['ì½”ê°€ ê½‰ ë§‰íŒ ëŠë‚Œì´ì—ìš”.', 'ìˆ¨ì„ ë“¤ì´ì‰¬ê¸°ê°€ ë„ˆë¬´ ë‹µë‹µí•´ìš”.', 'ì…ìœ¼ë¡œë§Œ ìˆ¨ ì‰¬ê³  ìˆì–´ì„œ ëª©ì´ ë‹¤ ë§ëì–´ìš”.', 'ë°¤ì— ì½”ê°€ ë§‰í˜€ì„œ ì ì„ ì˜ ëª» ì¤ì–´ìš”.', 'ì–‘ìª½ ë‹¤ ë§‰íŒ ê²ƒ ê°™ì•„ì„œ ê³µê¸°ê°€ ê±°ì˜ ì•ˆ í†µí•´ìš”.'],
      'ì¸í›„í†µ': ['ëª©ì´ ë”°ë”ë”°ë”í•´ì„œ ë¶ˆí¸í•´ìš”.', 'ì¹¨ ì‚¼í‚¬ ë•Œë§ˆë‹¤ ì•„íŒŒìš”.', 'ëª©ì´ ë„ˆë¬´ ê±´ì¡°í•´ì„œ ìê¾¸ ê¸°ì¹¨ì´ ë‚˜ìš”.', 'ëª© ì•ˆì´ ê¸íˆëŠ” ê²ƒì²˜ëŸ¼ ì•„íŒŒìš”.', 'ëª©ì´ ì•„íŒŒì„œ ëª©ì†Œë¦¬ê°€ ì˜ ì•ˆ ë‚˜ì™€ìš”.'],
      
      // ê¸°ì¹¨ ì¦ìƒ
      'ë§ˆë¥¸ê¸°ì¹¨': ['ëª©ì´ ê°„ì§ˆê±°ë ¤ì„œ ë§ˆë¥¸ ê¸°ì¹¨ì´ ê³„ì† ë‚˜ìš”.', 'ê°€ë˜ëŠ” ì•ˆ ë‚˜ì˜¤ëŠ”ë° ê¸°ì¹¨ë§Œ ê³„ì† ë‚˜ìš”.', 'ê¸°ì¹¨ì´ ë©ˆì¶”ì§ˆ ì•Šì•„ì„œ ë„ˆë¬´ í˜ë“¤ì–´ìš”.', 'ë§ë§Œ í•˜ë©´ ë°”ë¡œ ê¸°ì¹¨ì´ ë‚˜ì™€ìš”.'],
      'ê°€ë˜ê¸°ì¹¨': ['ê¸°ì¹¨í•  ë•Œë§ˆë‹¤ ê°€ë˜ê°€ ë¼ëŠ” ëŠë‚Œì´ì—ìš”.', 'ëª© ì•ˆì—ì„œ ê¼´ê¹ê±°ë¦¬ëŠ” ì†Œë¦¬ê°€ ë‚˜ìš”.', 'ê°€ë˜ê°€ ê±¸ë ¤ì„œ ê¸°ì¹¨ì„ í•´ë„ ì‹œì›í•˜ì§€ê°€ ì•Šì•„ìš”.', 'ê³„ì† ê°€ë˜ë¥¼ ë±‰ì–´ë‚´ê³  ìˆì–´ìš”.'],
      'ë°¤ì—ì‹¬í•œê¸°ì¹¨': ['ëˆ„ìš°ë©´ ê¸°ì¹¨ì´ ë” ì‹¬í•´ì ¸ì„œ ì ì„ ëª» ìê² ì–´ìš”.', 'ë°¤ë§ˆë‹¤ ê¸°ì¹¨ì´ ë„ì ¸ì„œ ê¹¨ìš”.', 'ì–´ì œë„ ìƒˆë²½ ë‚´ë‚´ ê¸°ì¹¨í•˜ëŠë¼ ê±°ì˜ ëª» ì¤ì–´ìš”.'],
      
      // ì „ì‹  ì¦ìƒ
      'ëª¸ì‚´': ['ì˜¨ëª¸ì´ ì‘¤ì…”ì„œ ì›€ì§ì´ê¸°ê°€ í˜ë“¤ì–´ìš”.', 'íŒ”ë‹¤ë¦¬ê°€ ë¬´ê²ê³  ë»ê·¼í•´ìš”.', 'í—ˆë¦¬ê°€ ë„ˆë¬´ ë»ê·¼í•´ì„œ ìì„¸ ì¡ê¸°ë„ í˜ë“¤ì–´ìš”.', 'ëª¸ì´ ë‹¤ ìš±ì‹ ê±°ë ¤ì„œ ì•„ë¬´ê²ƒë„ ëª» í•˜ê² ì–´ìš”.'],
      'ë‘í†µ': ['ë¨¸ë¦¬ê°€ ì§€ëˆê±°ë ¤ìš”.', 'ë¨¸ë¦¬ê°€ ì•„íŒŒì„œ ì§‘ì¤‘ì´ ì˜ ì•ˆ ë¼ìš”.', 'ëˆˆ ë’¤ìª½ì´ ë»ê·¼í•˜ê²Œ ì•„íŒŒìš”.', 'ë¨¸ë¦¬ ì „ì²´ê°€ ì¡°ì´ëŠ” ê²ƒì²˜ëŸ¼ ì•„íŒŒìš”.'],
      'í”¼ë¡œê°': ['í˜ì´ í•˜ë‚˜ë„ ì•ˆ ë‚˜ìš”.', 'ì¡°ê¸ˆë§Œ ì›€ì§ì—¬ë„ ê¸ˆë°© ì§€ì³ìš”.', 'ë¬´ê¸°ë ¥ì´ ê³„ì† ë°€ë ¤ì™€ì„œ ì•„ë¬´ê²ƒë„ í•˜ê¸° ì‹«ì–´ìš”.', 'ì¹¨ëŒ€ì—ì„œ ë‚˜ì˜¤ê¸°ê°€ ë„ˆë¬´ í˜ë“¤ì—ˆì–´ìš”.'],
      'ì‹ìš•ì €í•˜': ['ì…ë§›ì´ í†µ ì—†ì–´ìš”.', 'ë¨¹ì–´ë„ ë³„ë¡œ ë§›ì´ ì•ˆ ëŠê»´ì ¸ìš”.', 'ë°°ëŠ” ê³ í”ˆë° ë¨¹ê³  ì‹¶ì€ ê²Œ ì—†ì–´ìš”.'],
      
      // ì—´ ì¦ìƒ
      'ë°œì—´': ['ëª¸ì´ ëœ¨ê±°ì›Œì„œ ê³„ì† ì—´ì´ ë‚˜ëŠ” ê²ƒ ê°™ì•„ìš”.', 'ì–¼êµ´ì´ í™”ëˆê±°ë¦¬ê³  ì—´ê°ì´ ëŠê»´ì ¸ìš”.', 'ì—´ ë•Œë¬¸ì— ì ì„ ì œëŒ€ë¡œ ëª» ì¤ì–´ìš”.'],
      'ì˜¤í•œ': ['ëª¸ì´ ìœ¼ìŠ¬ìœ¼ìŠ¬ ì¶¥ê³  ì†Œë¦„ì´ ë‹ì•„ìš”.', 'ë‘êº¼ìš´ ì˜·ì„ ì…ì–´ë„ ìê¾¸ ì¶¥ê²Œ ëŠê»´ì ¸ìš”.', 'ì¶¥ë‹¤ê°€ ê°‘ìê¸° í™• ë”ì›Œì ¸ìš”.'],
      
      // ê¸°íƒ€
      'ì–´ì§€ëŸ¬ì›€': ['ì–´ì§€ëŸ¬ì›Œì„œ ì ê¹ ë²½ì— ê¸°ëŒ€ì—ˆì–´ìš”.', 'ê³ ê°œë¥¼ ë“¤ë©´ ì‚´ì§ ì–´ì§€ëŸ¬ì›Œìš”.', 'í•œ ë²ˆì”© í•‘ ë„ëŠ” ëŠë‚Œì´ ìˆì–´ìš”.'],
      'ë©”ìŠ¤êº¼ì›€': ['ê°€ë” ì¢€ ìš¸ë ê±°ë¦¬ê¸´ í•´ìš”.', 'ì†ì´ ì•½ê°„ ë¯¸ì‹ê±°ë¦¬ëŠ”ë° ê¸ˆë°© ê´œì°®ì•„ì ¸ìš”.']
    };
    
    // ë¶€ë¹„ë™ì—¼ íŠ¹ì´ ì‘ë‹µ
    const SINUSITIS_RESPONSES = {
      A: {
        question: 'í˜¹ì‹œ ì–¼êµ´ì´ë‚˜ ëˆˆ ì£¼ë³€ì´ ì•„í”„ê±°ë‚˜ ëˆŒë €ì„ ë•Œ ë” ì•„í”„ì§„ ì•Šìœ¼ì„¸ìš”?',
        positive: ['ë„¤â€¦ ì–¼êµ´ì´ ê½‰ ë§‰íŒ ëŠë‚Œì´ ë“¤ì–´ìš”.', 'ëˆˆ ì•„ë˜ê°€ ê³„ì† ìš±ì‹ ê±°ë ¤ìš”.', 'ì—¬ê¸°ë¥¼ ëˆ„ë¥´ë©´ ì°Œë¦¿í•˜ê²Œ ì•„íŒŒìš”.', 'ì–¼êµ´ ì „ì²´ê°€ ë¬´ê²ê²Œ ì‘¤ì‹œëŠ” ëŠë‚Œì´ì—ìš”.'],
        negative: ['ì•„ë‹ˆìš”, íŠ¹ë³„íˆ ê·¸ëŸ° ê±´ ì—†ì–´ìš”.', 'ì–¼êµ´ì€ ê´œì°®ì•„ìš”.']
      },
      B: {
        question: 'ì½§ë¬¼ì´ ì§„í•˜ê³ , ìƒ‰ì´ ë³€í–ˆê±°ë‚˜ ëƒ„ìƒˆê°€ ê°•í•˜ê²Œ ë‚˜ì§„ ì•Šìœ¼ì„¸ìš”?',
        positive: ['ì½”ë¥¼ í’€ë©´ íœ´ì§€ì—ì„œ ëƒ„ìƒˆê°€ ê°•í•˜ê²Œ ëŠê»´ì ¸ìš”.', 'ë…¸ë€ìƒ‰? ì´ˆë¡ìƒ‰? ì¢€ ì§„í•˜ë”ë¼ê³ ìš”.', 'ì½§ë¬¼ì´ ëˆì ê±°ë ¤ì„œ ì˜ ì•ˆ ë‚˜ì™€ìš”.'],
        negative: ['ì•„ë‹ˆìš”, ê·¸ëƒ¥ ë§‘ì€ ì½§ë¬¼ì´ì—ìš”.', 'ìƒ‰ì€ ê·¸ëƒ¥ íˆ¬ëª…í•´ìš”.']
      },
      C: {
        question: 'ê¸°ì¹¨ì€ ì–¸ì œë¶€í„° í•˜ì…¨ì–´ìš”? ë°¤ì— ë” ì‹¬í•´ì§€ì‹œë‚˜ìš”?',
        positive: ['í•œ ì‚¬ë‚˜í˜ ì •ë„ì¸ë°, ë°¤ì— íŠ¹íˆ ì‹¬í•´ìš”.', 'ì¼ì£¼ì¼ ë„˜ì—ˆëŠ”ë° ê³„ì† ê¸°ì¹¨ì´ ì•ˆ ê°€ë¼ì•‰ì•„ìš”.', 'ë°¤ì— ëˆ„ìš°ë©´ ê¸°ì¹¨ì´ ëª°ì•„ì„œ ë‚˜ìš”.'],
        negative: ['ì–´ì œë¶€í„° ì‹œì‘ëœ ê²ƒ ê°™ì•„ìš”.', 'í•˜ë£¨ ì´í‹€ ëì–´ìš”.']
      },
      D: {
        question: 'ë‘í†µì´ ê³ ê°œ ìˆ™ì¼ ë•Œ ë” ì‹¬í•´ì§€ì§€ëŠ” ì•Šìœ¼ì„¸ìš”?',
        positive: ['ì–´! ë§ì•„ìš”. ì„¸ìˆ˜í•˜ê¸°ê°€ í˜ë“¤ ì •ë„ì˜ˆìš”.', 'ìˆ™ì´ë©´ ëˆˆ ë’¤ìª½ì´ ì°Œë¦¿í•˜ê²Œ ì•„íŒŒìš”.', 'ê³ ê°œë¥¼ ìˆ™ì´ë©´ ë¨¸ë¦¬ê°€ ë¬´ê±°ì›Œì§€ë©´ì„œ í†µì¦ì´ í™• ì˜¬ë¼ìš”.'],
        negative: ['ì•„ë‹ˆìš”, íŠ¹ë³„íˆ ë‹¬ë¼ì§€ì§„ ì•Šì•„ìš”.', 'ê·¸ê±´ ì˜ ëª¨ë¥´ê² ì–´ìš”.']
      }
    };
    
    // ===== í™˜ì ìƒì„± =====
    function generatePatient() {
      const isSinusitis = Math.random() < 0.1; // 10% ë¶€ë¹„ë™ì—¼
      
      // ì¦ìƒ 2~5ê°œ ëœë¤ ì„ íƒ
      const allSymptoms = Object.keys(SYMPTOMS);
      const numSymptoms = 2 + Math.floor(Math.random() * 4);
      const shuffled = allSymptoms.sort(() => Math.random() - 0.5);
      const selectedSymptoms = shuffled.slice(0, numSymptoms);
      
      // ë°œì—´/ì˜¤í•œ ì—¬ë¶€ì— ë”°ë¥¸ ì²´ì˜¨
      const hasFever = selectedSymptoms.includes('ë°œì—´') || selectedSymptoms.includes('ì˜¤í•œ');
      let temp;
      if (isSinusitis) {
        temp = hasFever ? (37.5 + Math.random() * 1.0).toFixed(1) : (36.5 + Math.random() * 0.7).toFixed(1);
      } else {
        temp = hasFever ? (37.5 + Math.random() * 1.0).toFixed(1) : (36.3 + Math.random() * 0.7).toFixed(1);
      }
      
      // 1ì°¨ ëŒ€ë‹µì—ì„œ ë§í•  ì¦ìƒ (50~80%)
      const firstAnswerCount = Math.max(1, Math.floor(selectedSymptoms.length * (0.5 + Math.random() * 0.3)));
      const firstSymptoms = selectedSymptoms.slice(0, firstAnswerCount);
      const secondSymptoms = selectedSymptoms.slice(firstAnswerCount);
      
      // ë¶€ë¹„ë™ì—¼ íŠ¹ì´ ì¦ìƒ ìƒì„± (ë¶€ë¹„ë™ì—¼ì¸ ê²½ìš° 1~3ê°œ ì–‘ì„±)
      let sinusitisPositive = [];
      if (isSinusitis) {
        const questions = ['A', 'B', 'C', 'D'];
        const numPositive = 1 + Math.floor(Math.random() * 3);
        sinusitisPositive = questions.sort(() => Math.random() - 0.5).slice(0, numPositive);
      }
      
      return {
        isSinusitis,
        symptoms: selectedSymptoms,
        firstSymptoms,
        secondSymptoms,
        temperature: temp,
        sinusitisPositive
      };
    }
    
    // ===== ëŒ€ì‚¬ ìƒì„± =====
    function getSymptomDialogue(symptom) {
      const dialogues = SYMPTOMS[symptom];
      return dialogues[Math.floor(Math.random() * dialogues.length)];
    }
    
    function generateFirstAnswer(patient) {
      const dialogues = patient.firstSymptoms.map(s => getSymptomDialogue(s));
      return dialogues.join(' ');
    }
    
    function generateSecondAnswer(patient) {
      if (patient.secondSymptoms.length === 0) {
        return 'ë‹¤ë¥¸ ê³³ì€ ê´œì°®ì•„ìš”.';
      }
      const dialogues = patient.secondSymptoms.map(s => getSymptomDialogue(s));
      return dialogues.join(' ');
    }
    
    // ===== UI í•¨ìˆ˜ =====
    function addDialog(type, speaker, text) {
      const dialogBox = document.getElementById('dialog-box');
      const line = document.createElement('div');
      line.className = `dialog-line ${type}`;
      
      if (speaker) {
        line.innerHTML = `<span class="speaker ${type}">${speaker}:</span> ${text}`;
      } else {
        line.innerHTML = text;
      }
      
      dialogBox.appendChild(line);
      dialogBox.scrollTop = dialogBox.scrollHeight;
    }
    
    function clearChart() {
      document.getElementById('chart-temp').textContent = '-';
      document.getElementById('chart-symptoms').innerHTML = '<span style="color:#888;">-</span>';
    }
    
    function updateChart() {
      const symptomsDiv = document.getElementById('chart-symptoms');
      if (state.selectedSymptoms.length === 0) {
        symptomsDiv.innerHTML = '<span style="color:#888;">-</span>';
      } else {
        symptomsDiv.innerHTML = state.selectedSymptoms.map(s => 
          `<span class="symptom-tag">${s}</span>`
        ).join('');
      }
    }
    
    function updateGold(change) {
      state.gold += change;
      state.lastChange = change;
      
      document.getElementById('gold-total').textContent = state.gold;
      
      const changeEl = document.getElementById('gold-change');
      if (change > 0) {
        changeEl.className = 'gold-change positive';
        changeEl.textContent = `+${change} Gold`;
      } else if (change < 0) {
        changeEl.className = 'gold-change negative';
        changeEl.textContent = `${change} Gold`;
      } else {
        changeEl.className = 'gold-change neutral';
        changeEl.textContent = 'ìµœê·¼ ë³€ë™ ì—†ìŒ';
      }
    }
    
    function updateStats() {
      document.getElementById('stat-patients').textContent = state.patients;
      document.getElementById('stat-correct').textContent = state.correct;
      document.getElementById('stat-missed').textContent = state.missed;
    }
    
    // ===== ë²„íŠ¼ ì˜ì—­ ë Œë”ë§ =====
    function renderSymptomButtons() {
      const area = document.getElementById('button-area');
      const allSymptoms = Object.keys(SYMPTOMS);
      
      area.innerHTML = `
        <div class="button-title">ğŸ“ ì¦ìƒì„ ì„ íƒí•˜ì—¬ ì°¨íŠ¸ì— ê¸°ë¡í•˜ì„¸ìš”</div>
        <div class="symptom-buttons">
          ${allSymptoms.map(s => `
            <button class="symptom-btn ${state.selectedSymptoms.includes(s) ? 'selected' : ''}" 
                    onclick="toggleSymptom('${s}')">${s}</button>
          `).join('')}
        </div>
        <div class="action-buttons">
          <button class="action-btn primary" onclick="confirmSymptoms()">âœ… ì¦ìƒ ê¸°ë¡ ì™„ë£Œ</button>
        </div>
      `;
    }
    
    function renderAdditionalQuestionChoice() {
      const area = document.getElementById('button-area');
      area.innerHTML = `
        <div class="button-title">ğŸ¤” ì¶”ê°€ ì§ˆë¬¸ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
        <div class="action-buttons">
          <button class="action-btn success" onclick="askAdditionalQuestions()">Yes</button>
          <button class="action-btn secondary" onclick="skipTodiagnosis()">No</button>
        </div>
      `;
    }
    
    function renderQuestionButtons() {
      const area = document.getElementById('button-area');
      const askedKeys = state.sinusitisAnswers.map(a => a.key);
      const remainingQuestions = ['A', 'B', 'C', 'D'].filter(k => !askedKeys.includes(k));
      
      const questionLabels = {
        A: 'ì–¼êµ´/ëˆˆ ì£¼ë³€ í†µì¦',
        B: 'ì½§ë¬¼ ìƒ‰/ëƒ„ìƒˆ ë³€í™”',
        C: 'ê¸°ì¹¨ ì‹œì‘ ì‹œì ',
        D: 'ê³ ê°œ ìˆ™ì¼ ë•Œ ë‘í†µ'
      };
      
      area.innerHTML = `
        <div class="button-title">ğŸ” ì¶”ê°€ë¡œ ë¬¼ì–´ë³¼ ì§ˆë¬¸ì„ ì„ íƒí•˜ì„¸ìš”</div>
        <div class="symptom-buttons">
          ${remainingQuestions.map(key => `
            <button class="symptom-btn" onclick="askSinusitisQuestion('${key}')">${questionLabels[key]}</button>
          `).join('')}
        </div>
        <div class="action-buttons" style="margin-top: 15px;">
          <button class="action-btn danger" onclick="skipTodiagnosis()">ì§ˆë¬¸ ê·¸ë§Œí•˜ê³  ì§„ë‹¨í•˜ê¸°</button>
        </div>
      `;
    }
    
    function renderDiagnosisButtons() {
      const area = document.getElementById('button-area');
      area.innerHTML = `
        <div class="button-title">ğŸ©º ì§„ë‹¨ì„ ë‚´ë ¤ì£¼ì„¸ìš”</div>
        <div class="diagnosis-buttons">
          <button class="diagnosis-btn cold" onclick="makeDiagnosis('cold')">ğŸ’Š ê°ê¸° ì§„ë‹¨</button>
          <button class="diagnosis-btn report" onclick="makeDiagnosis('report')">ğŸ“ ìƒë¶€ ë³´ê³ </button>
        </div>
      `;
    }
    
    function renderNextPatientButton() {
      const area = document.getElementById('button-area');
      area.innerHTML = `
        <div class="action-buttons">
          <button class="action-btn primary" onclick="startNewPatient()">ğŸ©º ë‹¤ìŒ í™˜ì ë°›ê¸°</button>
        </div>
      `;
    }
    
    // ===== ê²Œì„ ë¡œì§ =====
    function startNewPatient() {
      // ì´ˆê¸°í™”
      state.currentPatient = generatePatient();
      state.selectedSymptoms = [];
      state.sinusitisAnswers = [];
      state.phase = 'firstQuestion';
      state.patients++;
      
      clearChart();
      updateStats();
      
      // ëŒ€í™” ì‹œì‘
      const dialogBox = document.getElementById('dialog-box');
      dialogBox.innerHTML = '';
      
      addDialog('nurse', 'ë² í…Œë‘ ê°„í˜¸ì‚¬', 'ê¹€ì„ ìƒë‹˜, ì´ í™˜ì ì¢€ ë´ì£¼ì„¸ìš”.');
      
      setTimeout(() => {
        addDialog('intern', 'ê¹€ ì¸í„´', 'í™˜ìë¶„ ì–´ë””ê°€ ë¶ˆí¸í•˜ì„¸ìš”?');
        
        setTimeout(() => {
          const firstAnswer = generateFirstAnswer(state.currentPatient);
          addDialog('patient', 'í™˜ì', firstAnswer);
          renderSymptomButtons();
        }, 800);
      }, 600);
    }
    
    function toggleSymptom(symptom) {
      const idx = state.selectedSymptoms.indexOf(symptom);
      if (idx >= 0) {
        state.selectedSymptoms.splice(idx, 1);
      } else {
        state.selectedSymptoms.push(symptom);
      }
      updateChart();
      renderSymptomButtons();
    }
    
    function confirmSymptoms() {
      if (state.phase === 'firstQuestion') {
        state.phase = 'secondQuestion';
        
        addDialog('intern', 'ê¹€ ì¸í„´', 'ì¶”ê°€ë¡œ ë” ë¶ˆí¸í•œ ê³³ì€ ì—†ìœ¼ì„¸ìš”?');
        
        setTimeout(() => {
          const secondAnswer = generateSecondAnswer(state.currentPatient);
          addDialog('patient', 'í™˜ì', secondAnswer);
          
          // 2ì°¨ ì§„ìˆ  í›„ì—ë„ ì¦ìƒ ì…ë ¥ ê¸°íšŒ ì œê³µ
          setTimeout(() => {
            renderSymptomButtons();
          }, 600);
        }, 600);
      } else if (state.phase === 'secondQuestion') {
        // 2ì°¨ ì¦ìƒ ê¸°ë¡ ì™„ë£Œ í›„ ì²´ì˜¨ ì•Œë¦¼
        state.phase = 'tempCheck';
        
        addDialog('nurse', 'ë² í…Œë‘ ê°„í˜¸ì‚¬', `í™˜ìë¶„ ì²´ì˜¨ì€ ${state.currentPatient.temperature}ë„ì˜ˆìš”.`);
        document.getElementById('chart-temp').textContent = `${state.currentPatient.temperature}Â°C`;
        
        setTimeout(() => {
          state.phase = 'additionalQuestion';
          renderAdditionalQuestionChoice();
        }, 600);
      }
    }
    
    function askAdditionalQuestions() {
      state.phase = 'sinusitisCheck';
      state.sinusitisAnswers = [];
      renderQuestionButtons();
    }
    
    function askSinusitisQuestion(questionKey) {
      const q = SINUSITIS_RESPONSES[questionKey];
      
      addDialog('intern', 'ê¹€ ì¸í„´', q.question);
      
      setTimeout(() => {
        const isPositive = state.currentPatient.sinusitisPositive.includes(questionKey);
        const responses = isPositive ? q.positive : q.negative;
        const response = responses[Math.floor(Math.random() * responses.length)];
        
        addDialog('patient', 'í™˜ì', response);
        
        if (isPositive) {
          addDialog('system', null, 'âš ï¸ [ì£¼ì˜ í•„ìš” ì¦ìƒ ê°ì§€]');
        }
        
        state.sinusitisAnswers.push({ key: questionKey, positive: isPositive });
        
        setTimeout(() => {
          // 4ê°œ ë‹¤ ë¬¼ì–´ë´¤ìœ¼ë©´ ì§„ë‹¨ìœ¼ë¡œ
          if (state.sinusitisAnswers.length >= 4) {
            state.phase = 'diagnosis';
            renderDiagnosisButtons();
          } else {
            renderQuestionButtons();
          }
        }, 600);
      }, 600);
    }
    
    function skipTodiagnosis() {
      state.phase = 'diagnosis';
      renderDiagnosisButtons();
    }
    
    function makeDiagnosis(type) {
      const patient = state.currentPatient;
      let goldChange = 0;
      let resultText = '';
      
      // ì¦ìƒ ì±„ì  ë¨¼ì €
      const actualSymptoms = patient.symptoms;
      const selectedSymptoms = state.selectedSymptoms;
      const wrong = selectedSymptoms.filter(s => !actualSymptoms.includes(s));
      const missed = actualSymptoms.filter(s => !selectedSymptoms.includes(s));
      const totalErrors = wrong.length + missed.length;
      const symptomPenalty = totalErrors * 20;
      
      if (type === 'cold') {
        if (patient.isSinusitis) {
          // ë¶€ë¹„ë™ì—¼ì¸ë° ê°ê¸°ë¡œ ì§„ë‹¨ = ì˜¤ì§„
          goldChange = -100;
          resultText = 'âŒ ì˜¤ì§„! ë¶€ë¹„ë™ì—¼ í™˜ìë¥¼ ê°ê¸°ë¡œ ì§„ë‹¨í–ˆìŠµë‹ˆë‹¤. (-100 Gold)';
          state.missed++;
        } else {
          // ê°ê¸° ë§ê²Œ ì§„ë‹¨
          goldChange = 100 - symptomPenalty;
          if (symptomPenalty > 0) {
            resultText = `âœ… ê°ê¸° ì§„ë‹¨ ì„±ê³µ! (+100 Gold, ì¦ìƒ ì˜¤ë¥˜ -${symptomPenalty} Gold = ${goldChange >= 0 ? '+' : ''}${goldChange} Gold)`;
          } else {
            resultText = 'âœ… ì™„ë²½í•œ ì§„ë‹¨! ê°ê¸° í™˜ìë¥¼ ì˜¬ë°”ë¥´ê²Œ ì§„ë‹¨í–ˆìŠµë‹ˆë‹¤. (+100 Gold)';
          }
          state.correct++;
        }
      } else if (type === 'report') {
        if (patient.isSinusitis) {
          // ë¶€ë¹„ë™ì—¼ ìƒë¶€ ë³´ê³  = ì •ë‹µ
          goldChange = 100 - symptomPenalty;
          if (symptomPenalty > 0) {
            resultText = `âœ… ìƒë¶€ ë³´ê³  ì„±ê³µ! (+100 Gold, ì¦ìƒ ì˜¤ë¥˜ -${symptomPenalty} Gold = ${goldChange >= 0 ? '+' : ''}${goldChange} Gold)`;
          } else {
            resultText = 'âœ… ì™„ë²½í•œ íŒë‹¨! ë¶€ë¹„ë™ì—¼ ì˜ì‹¬ í™˜ìë¥¼ ìƒë¶€ì— ë³´ê³ í–ˆìŠµë‹ˆë‹¤. (+100 Gold)';
          }
          state.correct++;
        } else {
          // ê°ê¸°ì¸ë° ìƒë¶€ ë³´ê³  = ì•ˆì „í•˜ì§€ë§Œ ë¹„íš¨ìœ¨
          goldChange = 50 - symptomPenalty;
          if (symptomPenalty > 0) {
            resultText = `âš ï¸ ì•ˆì „í•œ ì„ íƒ. ê°ê¸° í™˜ìë¥¼ ìƒë¶€ì— ë³´ê³ . (+50 Gold, ì¦ìƒ ì˜¤ë¥˜ -${symptomPenalty} Gold = ${goldChange >= 0 ? '+' : ''}${goldChange} Gold)`;
          } else {
            resultText = 'âš ï¸ ì•ˆì „í•œ ì„ íƒ. ê°ê¸° í™˜ìë¥¼ ìƒë¶€ì— ë³´ê³ í–ˆìŠµë‹ˆë‹¤. (+50 Gold)';
          }
        }
      }
      
      updateGold(goldChange);
      updateStats();
      
      addDialog('result', null, resultText);
      
      if (patient.isSinusitis) {
        addDialog('system', null, 'ğŸ“‹ ì‹¤ì œ ì§„ë‹¨: ë¶€ë¹„ë™ì—¼ (Sinusitis)');
      } else {
        addDialog('system', null, 'ğŸ“‹ ì‹¤ì œ ì§„ë‹¨: ê°ê¸° (Common Cold)');
      }
      
      // ì¦ìƒ ë§¤ì¹­ ê²°ê³¼ í‘œì‹œ
      showSymptomFeedback(patient);
      
      state.phase = 'idle';
      
      // 100ëª… ë„ë‹¬ ì²´í¬
      if (state.patients >= 100) {
        setTimeout(() => {
          checkEnding();
        }, 1500);
      } else {
        renderNextPatientButton();
      }
    }
    
    function showSymptomFeedback(patient) {
      const actualSymptoms = patient.symptoms;
      const selectedSymptoms = state.selectedSymptoms;
      
      // ì •ë‹µ (ì„ íƒ O, ì‹¤ì œ O)
      const correct = selectedSymptoms.filter(s => actualSymptoms.includes(s));
      // ì˜¤ë‹µ (ì„ íƒ O, ì‹¤ì œ X)
      const wrong = selectedSymptoms.filter(s => !actualSymptoms.includes(s));
      // ë†“ì¹œ ì¦ìƒ (ì„ íƒ X, ì‹¤ì œ O)
      const missed = actualSymptoms.filter(s => !selectedSymptoms.includes(s));
      
      let feedbackHtml = '<div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">';
      feedbackHtml += '<div style="font-weight: bold; margin-bottom: 8px;">ğŸ“Š ì¦ìƒ ê¸°ë¡ ê²°ê³¼</div>';
      
      if (correct.length > 0) {
        feedbackHtml += '<div style="margin-bottom: 5px;">';
        correct.forEach(s => {
          feedbackHtml += `<span style="display: inline-block; margin: 2px; padding: 3px 8px; background: rgba(46,204,113,0.3); border: 2px solid #2ecc71; border-radius: 15px; color: #2ecc71;">â­• ${s}</span>`;
        });
        feedbackHtml += '</div>';
      }
      
      if (wrong.length > 0) {
        feedbackHtml += '<div style="margin-bottom: 5px;">';
        wrong.forEach(s => {
          feedbackHtml += `<span style="display: inline-block; margin: 2px; padding: 3px 8px; background: rgba(0,0,0,0.3); border: 2px solid #333; border-radius: 15px; color: #888;">âœ– ${s}</span>`;
        });
        feedbackHtml += '</div>';
      }
      
      if (missed.length > 0) {
        feedbackHtml += '<div style="margin-bottom: 5px;">';
        missed.forEach(s => {
          feedbackHtml += `<span style="display: inline-block; margin: 2px; padding: 3px 8px; background: rgba(46,204,113,0.15); border: 2px solid #2ecc71; border-radius: 4px; color: #2ecc71;">ğŸ“Œ ${s}</span>`;
        });
        feedbackHtml += '</div>';
      }
      
      // ì ìˆ˜ í‘œì‹œ
      const total = actualSymptoms.length;
      const score = correct.length;
      feedbackHtml += `<div style="margin-top: 8px; font-size: 0.85rem; color: #aaa;">ì¦ìƒ ì •í™•ë„: ${score}/${total} (${Math.round(score/total*100)}%)</div>`;
      
      feedbackHtml += '</div>';
      
      const dialogBox = document.getElementById('dialog-box');
      const feedbackDiv = document.createElement('div');
      feedbackDiv.className = 'dialog-line system';
      feedbackDiv.innerHTML = feedbackHtml;
      dialogBox.appendChild(feedbackDiv);
      dialogBox.scrollTop = dialogBox.scrollHeight;
    }
    
    // ===== ì´ˆê¸°í™” =====
    function init() {
      addDialog('system', null, '"ë‹¤ìŒ í™˜ì ë°›ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.');
    }
    
    // ===== í…ŒìŠ¤íŠ¸ íŒ¨ë„ =====
    function toggleTestPanel() {
      const content = document.getElementById('test-content');
      const title = document.querySelector('.test-title');
      if (content.style.display === 'none') {
        content.style.display = 'block';
        title.textContent = 'ğŸ”§ í…ŒìŠ¤íŠ¸ ëª¨ë“œ (í´ë¦­í•˜ì—¬ ë‹«ê¸°)';
      } else {
        content.style.display = 'none';
        title.textContent = 'ğŸ”§ í…ŒìŠ¤íŠ¸ ëª¨ë“œ (í´ë¦­í•˜ì—¬ ì—´ê¸°)';
      }
    }
    
    function updateTestStats() {
      // ì…ë ¥ ê°’ ê²€ì¦
      const patients = parseInt(document.getElementById('test-patients').value) || 0;
      const correct = parseInt(document.getElementById('test-correct').value) || 0;
      const missed = parseInt(document.getElementById('test-missed').value) || 0;
      
      document.getElementById('test-patients').value = Math.min(100, Math.max(0, patients));
      document.getElementById('test-correct').value = Math.min(100, Math.max(0, correct));
      document.getElementById('test-missed').value = Math.min(100, Math.max(0, missed));
    }
    
    function applyTestStats() {
      state.patients = parseInt(document.getElementById('test-patients').value) || 0;
      state.correct = parseInt(document.getElementById('test-correct').value) || 0;
      state.missed = parseInt(document.getElementById('test-missed').value) || 0;
      
      updateStats();
      addDialog('system', null, `ğŸ“Š í…ŒìŠ¤íŠ¸ ê°’ ì ìš©: ì§„ë£Œ ${state.patients}ëª…, ì •í™• ${state.correct}ëª…, ì˜¤ì§„ ${state.missed}ëª…`);
      
      // 100ëª… ë„ë‹¬ ì²´í¬
      checkEnding();
    }
    
    // ===== ì—”ë”© ì²´í¬ =====
    function checkEnding() {
      if (state.patients >= 100) {
        if (state.correct >= 95) {
          showSuccessEnding();
        } else {
          showFailEnding();
        }
      }
    }
    
    function showSuccessEnding() {
      const rate = Math.round(state.correct / state.patients * 100);
      document.getElementById('ending-patients').textContent = state.patients;
      document.getElementById('ending-correct').textContent = state.correct;
      document.getElementById('ending-rate').textContent = rate + '%';
      document.getElementById('ending-screen').style.display = 'flex';
    }
    
    function showFailEnding() {
      const rate = Math.round(state.correct / state.patients * 100);
      document.getElementById('fail-patients').textContent = state.patients;
      document.getElementById('fail-correct').textContent = state.correct;
      document.getElementById('fail-rate').textContent = rate + '%';
      document.getElementById('fail-screen').style.display = 'flex';
    }
    
    function continueGame() {
      document.getElementById('ending-screen').style.display = 'none';
      document.getElementById('bankrupt-screen').style.display = 'flex';
    }
    
    function restartGame() {
      // ëª¨ë“  ì—”ë”© í™”ë©´ ìˆ¨ê¸°ê¸°
      document.getElementById('ending-screen').style.display = 'none';
      document.getElementById('fail-screen').style.display = 'none';
      document.getElementById('bankrupt-screen').style.display = 'none';
      
      // ìƒíƒœ ì´ˆê¸°í™”
      state.gold = 0;
      state.lastChange = 0;
      state.patients = 0;
      state.correct = 0;
      state.missed = 0;
      state.phase = 'idle';
      state.currentPatient = null;
      state.selectedSymptoms = [];
      state.sinusitisAnswers = [];
      
      // UI ì´ˆê¸°í™”
      document.getElementById('gold-total').textContent = '0';
      document.getElementById('gold-change').className = 'gold-change neutral';
      document.getElementById('gold-change').textContent = 'ìµœê·¼ ë³€ë™ ì—†ìŒ';
      updateStats();
      clearChart();
      
      // í…ŒìŠ¤íŠ¸ íƒ­ ê°’ ì´ˆê¸°í™”
      document.getElementById('test-patients').value = 0;
      document.getElementById('test-correct').value = 0;
      document.getElementById('test-missed').value = 0;
      
      // ëŒ€í™”ì°½ ì´ˆê¸°í™”
      const dialogBox = document.getElementById('dialog-box');
      dialogBox.innerHTML = '';
      addDialog('system', null, 'ğŸ‘©â€âš•ï¸ ì‘ê¸‰ì‹¤ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤, ê¹€ ì„ ìƒë‹˜.');
      addDialog('system', null, '"ë‹¤ìŒ í™˜ì ë°›ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.');
      
      // ë²„íŠ¼ ì˜ì—­ ì´ˆê¸°í™”
      const area = document.getElementById('button-area');
      area.innerHTML = `
        <div style="text-align: center; margin-bottom: 15px; color: #4ecdc4; font-size: 1rem;">
          ğŸ¯ 100ëª…ì˜ í™˜ì ì¤‘ì—ì„œ 95ëª… ì´ìƒì„ ì§„ë‹¨í•˜ëŠ” ëª…í’ˆ ì¸í„´ì— ë„ì „í•˜ì„¸ìš”!
        </div>
        <div class="action-buttons">
          <button class="action-btn primary" id="btn-start" onclick="startNewPatient()">
            ğŸ©º ë‹¤ìŒ í™˜ì ë°›ê¸°
          </button>
        </div>
      `;
    }
    
    init();
  </script>
</body>
</html>
