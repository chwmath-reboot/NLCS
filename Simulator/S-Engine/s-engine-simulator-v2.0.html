<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S-Engine æˆ°é¬ª è©¦æ¼”å™¨ v2</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Serif+KR:wght@600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      min-height: 100vh;
      background: linear-gradient(180deg, #0a0a0f 0%, #1a1a2e 50%, #0a0a0f 100%);
      color: #e0e0e0;
      font-family: 'Noto Sans KR', -apple-system, sans-serif;
      padding: 30px 20px;
    }
    
    .container { max-width: 1400px; margin: 0 auto; }
    
    header { text-align: center; margin-bottom: 30px; }
    
    h1 {
      font-family: 'Noto Serif KR', serif;
      font-size: 2.2rem;
      font-weight: 700;
      background: linear-gradient(135deg, #ffd700 0%, #ff6b35 50%, #ffd700 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 6px;
    }
    
    .subtitle { color: #888; font-size: 0.9rem; }
    
    .main-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    @media (max-width: 1100px) {
      .main-layout { grid-template-columns: 1fr; }
    }
    
    .panels {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .panel {
      border-radius: 12px;
      padding: 20px;
    }
    
    .panel.attacker {
      background: linear-gradient(135deg, rgba(231,76,60,0.08) 0%, rgba(231,76,60,0.02) 100%);
      border: 2px solid rgba(231,76,60,0.25);
    }
    
    .panel.defender {
      background: linear-gradient(135deg, rgba(52,152,219,0.08) 0%, rgba(52,152,219,0.02) 100%);
      border: 2px solid rgba(52,152,219,0.25);
    }
    
    .panel h2 {
      font-family: 'Noto Serif KR', serif;
      font-size: 1.3rem;
      text-align: center;
      margin-bottom: 16px;
    }
    
    .panel.attacker h2 { color: #e74c3c; }
    .panel.defender h2 { color: #3498db; }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .form-group { }
    
    label {
      display: block;
      margin-bottom: 4px;
      color: #a0a0a0;
      font-size: 0.8rem;
    }
    
    .highlight-red { color: #e74c3c; }
    .highlight-blue { color: #3498db; }
    .highlight-gold { color: #ffd700; }
    .highlight-green { color: #2ecc71; }
    
    input[type="text"], select {
      width: 100%;
      padding: 8px 10px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      color: #fff;
      font-size: 0.9rem;
      font-family: inherit;
    }
    
    input[type="range"] {
      width: 100%;
      margin-top: 2px;
    }
    
    .status-bars {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    
    .status-bar {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 8px 12px;
    }
    
    .bar-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      margin-bottom: 4px;
    }
    
    .bar-track {
      height: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .bar-fill {
      height: 100%;
      transition: width 0.3s ease;
    }
    
    .bar-fill.hp { background: linear-gradient(90deg, #c0392b, #e74c3c); }
    .bar-fill.neigong { background: linear-gradient(90deg, #2980b9, #3498db); }
    
    .calc-result {
      margin-top: 12px;
      padding: 12px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
      font-size: 0.8rem;
    }
    
    .calc-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
    }
    
    .calc-grid .full { grid-column: 1 / -1; text-align: center; margin-top: 4px; }
    
    /* ì „íˆ¬ ë¡œê·¸ ì˜ì—­ */
    .battle-section {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .battle-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .btn {
      padding: 12px 24px;
      font-size: 1rem;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn:hover { transform: scale(1.03); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    
    .btn-battle {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      color: #fff;
      box-shadow: 0 4px 15px rgba(231,76,60,0.3);
    }
    
    .btn-auto {
      background: linear-gradient(135deg, #f39c12 0%, #d68910 100%);
      color: #fff;
      box-shadow: 0 4px 15px rgba(243,156,18,0.3);
    }
    
    .btn-reset {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: #aaa;
    }
    
    .btn-stop {
      background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
      color: #fff;
    }
    
    .battle-log-container {
      flex: 1;
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      min-height: 500px;
      max-height: 700px;
    }
    
    .log-header {
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .log-header h3 {
      color: #ffd700;
      font-family: 'Noto Serif KR', serif;
      font-size: 1.1rem;
    }
    
    .round-counter {
      background: rgba(255,215,0,0.2);
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.85rem;
      color: #ffd700;
    }
    
    .log-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      font-family: 'D2Coding', monospace, sans-serif;
      font-size: 0.85rem;
      line-height: 1.6;
    }
    
    .log-line { margin-bottom: 2px; color: #bbb; }
    .log-line.title { color: #ffd700; font-weight: bold; }
    .log-line.danger { color: #e74c3c; }
    .log-line.warning { color: #f39c12; }
    .log-line.success { color: #2ecc71; }
    .log-line.info { color: #3498db; }
    .log-line.divider { color: #555; }
    .log-line.round-title { 
      color: #fff; 
      background: rgba(255,255,255,0.1); 
      padding: 4px 8px; 
      border-radius: 4px;
      margin: 8px 0;
    }
    
    .battle-result {
      padding: 16px;
      border-top: 1px solid rgba(255,255,255,0.1);
      text-align: center;
    }
    
    .result-text {
      font-family: 'Noto Serif KR', serif;
      font-size: 1.3rem;
    }
    
    .result-winner { color: #ffd700; }
    .result-draw { color: #9b59b6; }
    
    /* ë„ì£¼ ê¶Œì¥ ì•Œë¦¼ */
    .flee-warning {
      background: rgba(243,156,18,0.2);
      border: 1px solid rgba(243,156,18,0.5);
      border-radius: 8px;
      padding: 12px;
      margin-top: 8px;
      text-align: center;
    }
    
    .flee-warning .icon { font-size: 1.5rem; }
    .flee-warning .text { color: #f39c12; font-size: 0.9rem; margin-top: 4px; }
    
    footer {
      text-align: center;
      margin-top: 30px;
      color: #555;
      font-size: 0.8rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>S-Engine æˆ°é¬ª è©¦æ¼”å™¨</h1>
      <p class="subtitle">ë¬´í˜‘ ì„¸ê³„ê´€ ì „íˆ¬ ì‹œë®¬ë ˆì´í„° v2.0 - ë³´ë²• & ì—°ì†ì „íˆ¬</p>
    </header>
    
    <div class="main-layout">
      <!-- ì¢Œì¸¡: ìºë¦­í„° ì„¤ì • -->
      <div class="panels">
        <!-- ê³µê²©ì íŒ¨ë„ -->
        <div class="panel attacker">
          <h2>âš”ï¸ ê³µê²©ì</h2>
          
          <div class="form-row">
            <div class="form-group">
              <label>ì´ë¦„</label>
              <input type="text" id="atk-name" value="ê²€í˜¸">
            </div>
            <div class="form-group">
              <label>ê²½ì§€ <span class="highlight-red" id="atk-gyeongji-label">çµ¶é ‚</span></label>
              <select id="atk-gyeongji" onchange="updateAll()">
                <option value="ì‚¼ë¥˜">ì‚¼ë¥˜ (ä¸‰æµ)</option>
                <option value="ì´ë¥˜">ì´ë¥˜ (äºŒæµ)</option>
                <option value="ì¼ë¥˜">ì¼ë¥˜ (ä¸€æµ)</option>
                <option value="ì ˆì •" selected>ì ˆì • (çµ¶é ‚)</option>
                <option value="ì´ˆì ˆì •">ì´ˆì ˆì • (è¶…çµ¶é ‚)</option>
                <option value="í™”ê²½">í™”ê²½ (åŒ–å¢ƒ)</option>
                <option value="í˜„ê²½">í˜„ê²½ (ç„å¢ƒ)</option>
                <option value="ìƒì‚¬ê²½">ìƒì‚¬ê²½ (ç”Ÿæ­»å¢ƒ)</option>
                <option value="ìì—°ê²½">ìì—°ê²½ (è‡ªç„¶å¢ƒ)</option>
              </select>
            </div>
            <div class="form-group">
              <label>ì‹¬ë²•</label>
              <select id="atk-simbeop" onchange="updateAll()">
                <option value="ì‚¼ì¬ì‹¬ë²•">ì‚¼ì¬ì‹¬ë²•</option>
                <option value="ê¸°ì´ˆì‹¬ë²•">ê¸°ì´ˆì‹¬ë²•</option>
                <option value="ê¸°ë³¸ì‹¬ë²•" selected>ê¸°ë³¸ì‹¬ë²•</option>
                <option value="ì‹¬í™”ì‹¬ë²•">ì‹¬í™”ì‹¬ë²•</option>
                <option value="ë¹„ì „ì‹¬ë²•">ë¹„ì „ì‹¬ë²•</option>
                <option value="ëª…ìš´ì‹¬ë²•">ëª…ìš´ì‹¬ë²•</option>
                <option value="ë‹¬ë§ˆì‹¬ê³µ">ë‹¬ë§ˆì‹¬ê³µ</option>
                <option value="ì²œë§ˆì‹¬ê³µ">ì²œë§ˆì‹¬ê³µ</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>ë³´ë²• <span class="highlight-gold" id="atk-bobeop-label">Lv5</span></label>
              <select id="atk-bobeop" onchange="updateAll()">
                <option value="0">ì—†ìŒ</option>
                <option value="1">ê¸°ì´ˆë³´ë²• 1ë‹¨ê³„ (Lv1)</option>
                <option value="2">ê¸°ì´ˆë³´ë²• 2ë‹¨ê³„ (Lv2)</option>
                <option value="3">ê¸°ì´ˆë³´ë²• 3ë‹¨ê³„ (Lv3)</option>
                <option value="4">ê¸°ë³¸ë³´ë²• 1ë‹¨ê³„ (Lv4)</option>
                <option value="5" selected>ê¸°ë³¸ë³´ë²• 2ë‹¨ê³„ (Lv5)</option>
                <option value="6">ê¸°ë³¸ë³´ë²• 3ë‹¨ê³„ (Lv6)</option>
                <option value="7">ì‹¬í™”ë³´ë²• 1ë‹¨ê³„ (Lv7)</option>
                <option value="8">ì‹¬í™”ë³´ë²• 2ë‹¨ê³„ (Lv8)</option>
                <option value="9">ì‹¬í™”ë³´ë²• 3ë‹¨ê³„ (Lv9)</option>
              </select>
            </div>
            <div class="form-group">
              <label>ìš´ê¸°ì§„í–‰ë„: <span id="atk-ungi-val">100</span>%</label>
              <input type="range" id="atk-ungi" min="80" max="100" value="100" 
                     style="accent-color: #e74c3c;" oninput="updateAll()">
            </div>
          </div>
          
          <div class="status-bars">
            <div class="status-bar">
              <div class="bar-label">
                <span>ì²´ë ¥</span>
                <span class="highlight-red" id="atk-hp-text">100 / 100</span>
              </div>
              <div class="bar-track">
                <div class="bar-fill hp" id="atk-hp-bar" style="width: 100%"></div>
              </div>
              <input type="range" id="atk-hp" min="1" max="100" value="100" 
                     style="accent-color: #e74c3c; margin-top: 4px;" oninput="updateAll()">
            </div>
            <div class="status-bar">
              <div class="bar-label">
                <span>ë‚´ê³µ</span>
                <span class="highlight-blue" id="atk-neigong-text">100 / 100</span>
              </div>
              <div class="bar-track">
                <div class="bar-fill neigong" id="atk-neigong-bar" style="width: 100%"></div>
              </div>
              <input type="range" id="atk-neigong" min="1" max="100" value="100" 
                     style="accent-color: #3498db; margin-top: 4px;" oninput="updateAll()">
            </div>
          </div>
          
          <div class="calc-result">
            <div class="calc-grid">
              <div>ìš´ê¸°ê²½ë¡œ: <span class="highlight-red" id="atk-calc-gyeongro">5.48</span></div>
              <div>ê³µê²©ì†ë„: <span class="highlight-red" id="atk-calc-speed">1.50</span>ì´ˆ</div>
              <div>ì´ë™ì†ë„: <span class="highlight-gold" id="atk-calc-move">âˆš5</span></div>
              <div>ë³´ë²• ì¶”ê°€í”¼í•´: <span class="highlight-gold" id="atk-calc-bobeop">+50%</span></div>
              <div>ìš´ê¸°ìœ„í—˜ì„±: <span class="highlight-red" id="atk-calc-danger">0.120</span></div>
              <div>ì „íˆ¬ë¶ˆëŠ¥: <span class="highlight-red" id="atk-calc-threshold">40%</span></div>
              <div class="full">ë‚´ê³µíŒŒê´´ë ¥: <span class="highlight-red" style="font-size:1.1rem;font-weight:bold" id="atk-calc-power">5.48</span> â†’ ë³´ë²• ì ìš©: <span class="highlight-gold" style="font-size:1.1rem;font-weight:bold" id="atk-calc-total">8.22</span></div>
            </div>
          </div>
          
          <div class="flee-warning" id="atk-flee" style="display: none;">
            <div class="icon">âš ï¸</div>
            <div class="text">ë„ì£¼ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤!</div>
          </div>
        </div>
        
        <!-- ë°©ì–´ì íŒ¨ë„ -->
        <div class="panel defender">
          <h2>ğŸ›¡ï¸ ë°©ì–´ì</h2>
          
          <div class="form-row">
            <div class="form-group">
              <label>ì´ë¦„</label>
              <input type="text" id="def-name" value="ë„ì ">
            </div>
            <div class="form-group">
              <label>ê²½ì§€ <span class="highlight-blue" id="def-gyeongji-label">ä¸€æµ</span></label>
              <select id="def-gyeongji" onchange="updateAll()">
                <option value="ì‚¼ë¥˜">ì‚¼ë¥˜ (ä¸‰æµ)</option>
                <option value="ì´ë¥˜">ì´ë¥˜ (äºŒæµ)</option>
                <option value="ì¼ë¥˜" selected>ì¼ë¥˜ (ä¸€æµ)</option>
                <option value="ì ˆì •">ì ˆì • (çµ¶é ‚)</option>
                <option value="ì´ˆì ˆì •">ì´ˆì ˆì • (è¶…çµ¶é ‚)</option>
                <option value="í™”ê²½">í™”ê²½ (åŒ–å¢ƒ)</option>
                <option value="í˜„ê²½">í˜„ê²½ (ç„å¢ƒ)</option>
                <option value="ìƒì‚¬ê²½">ìƒì‚¬ê²½ (ç”Ÿæ­»å¢ƒ)</option>
                <option value="ìì—°ê²½">ìì—°ê²½ (è‡ªç„¶å¢ƒ)</option>
              </select>
            </div>
            <div class="form-group">
              <label>ì‹¬ë²•</label>
              <select id="def-simbeop" onchange="updateAll()">
                <option value="ì‚¼ì¬ì‹¬ë²•">ì‚¼ì¬ì‹¬ë²•</option>
                <option value="ê¸°ì´ˆì‹¬ë²•" selected>ê¸°ì´ˆì‹¬ë²•</option>
                <option value="ê¸°ë³¸ì‹¬ë²•">ê¸°ë³¸ì‹¬ë²•</option>
                <option value="ì‹¬í™”ì‹¬ë²•">ì‹¬í™”ì‹¬ë²•</option>
                <option value="ë¹„ì „ì‹¬ë²•">ë¹„ì „ì‹¬ë²•</option>
                <option value="ëª…ìš´ì‹¬ë²•">ëª…ìš´ì‹¬ë²•</option>
                <option value="ë‹¬ë§ˆì‹¬ê³µ">ë‹¬ë§ˆì‹¬ê³µ</option>
                <option value="ì²œë§ˆì‹¬ê³µ">ì²œë§ˆì‹¬ê³µ</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>ë³´ë²• <span class="highlight-gold" id="def-bobeop-label">Lv3</span></label>
              <select id="def-bobeop" onchange="updateAll()">
                <option value="0">ì—†ìŒ</option>
                <option value="1">ê¸°ì´ˆë³´ë²• 1ë‹¨ê³„ (Lv1)</option>
                <option value="2">ê¸°ì´ˆë³´ë²• 2ë‹¨ê³„ (Lv2)</option>
                <option value="3" selected>ê¸°ì´ˆë³´ë²• 3ë‹¨ê³„ (Lv3)</option>
                <option value="4">ê¸°ë³¸ë³´ë²• 1ë‹¨ê³„ (Lv4)</option>
                <option value="5">ê¸°ë³¸ë³´ë²• 2ë‹¨ê³„ (Lv5)</option>
                <option value="6">ê¸°ë³¸ë³´ë²• 3ë‹¨ê³„ (Lv6)</option>
                <option value="7">ì‹¬í™”ë³´ë²• 1ë‹¨ê³„ (Lv7)</option>
                <option value="8">ì‹¬í™”ë³´ë²• 2ë‹¨ê³„ (Lv8)</option>
                <option value="9">ì‹¬í™”ë³´ë²• 3ë‹¨ê³„ (Lv9)</option>
              </select>
            </div>
            <div class="form-group">
              <label>ìš´ê¸°ì§„í–‰ë„: <span id="def-ungi-val">90</span>%</label>
              <input type="range" id="def-ungi" min="80" max="100" value="90" 
                     style="accent-color: #3498db;" oninput="updateAll()">
            </div>
          </div>
          
          <div class="status-bars">
            <div class="status-bar">
              <div class="bar-label">
                <span>ì²´ë ¥</span>
                <span class="highlight-red" id="def-hp-text">100 / 100</span>
              </div>
              <div class="bar-track">
                <div class="bar-fill hp" id="def-hp-bar" style="width: 100%"></div>
              </div>
              <input type="range" id="def-hp" min="1" max="100" value="100" 
                     style="accent-color: #e74c3c; margin-top: 4px;" oninput="updateAll()">
            </div>
            <div class="status-bar">
              <div class="bar-label">
                <span>ë‚´ê³µ</span>
                <span class="highlight-blue" id="def-neigong-text">100 / 100</span>
              </div>
              <div class="bar-track">
                <div class="bar-fill neigong" id="def-neigong-bar" style="width: 100%"></div>
              </div>
              <input type="range" id="def-neigong" min="1" max="100" value="100" 
                     style="accent-color: #3498db; margin-top: 4px;" oninput="updateAll()">
            </div>
          </div>
          
          <div class="calc-result">
            <div class="calc-grid">
              <div>ìš´ê¸°ê²½ë¡œ: <span class="highlight-blue" id="def-calc-gyeongro">4.47</span></div>
              <div>ê³µê²©ì†ë„: <span class="highlight-blue" id="def-calc-speed">1.73</span>ì´ˆ</div>
              <div>ì´ë™ì†ë„: <span class="highlight-gold" id="def-calc-move">âˆš3</span></div>
              <div>ë³´ë²• ì¶”ê°€í”¼í•´: <span class="highlight-gold" id="def-calc-bobeop">+30%</span></div>
              <div>ìš´ê¸°ìœ„í—˜ì„±: <span class="highlight-blue" id="def-calc-danger">0.112</span></div>
              <div>ì „íˆ¬ë¶ˆëŠ¥: <span class="highlight-blue" id="def-calc-threshold">40%</span></div>
              <div class="full">ë‚´ê³µíŒŒê´´ë ¥: <span class="highlight-blue" style="font-size:1.1rem;font-weight:bold" id="def-calc-power">4.02</span> â†’ ë³´ë²• ì ìš©: <span class="highlight-gold" style="font-size:1.1rem;font-weight:bold" id="def-calc-total">5.23</span></div>
            </div>
          </div>
          
          <div class="flee-warning" id="def-flee" style="display: none;">
            <div class="icon">âš ï¸</div>
            <div class="text">ë„ì£¼ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤!</div>
          </div>
        </div>
      </div>
      
      <!-- ìš°ì¸¡: ì „íˆ¬ ë¡œê·¸ -->
      <div class="battle-section">
        <div class="battle-controls">
          <button class="btn btn-battle" onclick="executeOneRound()">âš”ï¸ 1í•©</button>
          <button class="btn btn-auto" id="btn-auto" onclick="startAutoBattle()">ğŸ”„ ìë™ ì „íˆ¬</button>
          <button class="btn btn-stop" id="btn-stop" onclick="stopAutoBattle()" style="display:none;">â¹ï¸ ì¤‘ì§€</button>
          <button class="btn btn-reset" onclick="resetBattle()">â†º ì´ˆê¸°í™”</button>
        </div>
        
        <div class="battle-log-container">
          <div class="log-header">
            <h3>ğŸ“œ ì „íˆ¬ ê¸°ë¡</h3>
            <div class="round-counter">ì œ <span id="round-num">0</span> í•©</div>
          </div>
          <div class="log-content" id="log-content">
            <div class="log-line info">ì „íˆ¬ë¥¼ ì‹œì‘í•˜ë ¤ë©´ [1í•©] ë˜ëŠ” [ìë™ ì „íˆ¬] ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>
          </div>
          <div class="battle-result" id="battle-result" style="display: none;">
            <div class="result-text" id="result-text"></div>
          </div>
        </div>
      </div>
    </div>
    
    <footer>
      S-Engine Combat Simulator v2.0 by ShadowK
    </footer>
  </div>
  
  <script>
    // ===== ë°ì´í„° ì •ì˜ =====
    const GYEONGJI_DATA = {
      'ì‚¼ë¥˜': { level: 1, attackSpeed: Math.sqrt(1), label: 'ä¸‰æµ', maxBobeop: 2 },
      'ì´ë¥˜': { level: 2, attackSpeed: Math.sqrt(2), label: 'äºŒæµ', maxBobeop: 3 },
      'ì¼ë¥˜': { level: 3, attackSpeed: Math.sqrt(3), label: 'ä¸€æµ', maxBobeop: 4 },
      'ì ˆì •': { level: 4, attackSpeed: Math.sqrt(4), label: 'çµ¶é ‚', maxBobeop: 5 },
      'ì´ˆì ˆì •': { level: 5, attackSpeed: Math.sqrt(5), label: 'è¶…çµ¶é ‚', maxBobeop: 6 },
      'í™”ê²½': { level: 6, attackSpeed: Math.sqrt(6), label: 'åŒ–å¢ƒ', maxBobeop: 7 },
      'í˜„ê²½': { level: 7, attackSpeed: Math.sqrt(7), label: 'ç„å¢ƒ', maxBobeop: 8 },
      'ìƒì‚¬ê²½': { level: 8, attackSpeed: Math.sqrt(8), label: 'ç”Ÿæ­»å¢ƒ', maxBobeop: 9 },
      'ìì—°ê²½': { level: 9, attackSpeed: Math.sqrt(9), label: 'è‡ªç„¶å¢ƒ', maxBobeop: 10 }
    };
    
    const SIMBEOP_DATA = {
      'ì‚¼ì¬ì‹¬ë²•': { chukgi: 10, stability: 90, total: 100, type: 'ê¸°ë³¸' },
      'ê¸°ì´ˆì‹¬ë²•': { chukgi: 20, stability: 80, total: 100, type: 'ê¸°ì´ˆ' },
      'ê¸°ë³¸ì‹¬ë²•': { chukgi: 30, stability: 70, total: 100, type: 'ê¸°ë³¸' },
      'ì‹¬í™”ì‹¬ë²•': { chukgi: 40, stability: 70, total: 110, type: 'ì‹¬í™”' },
      'ë¹„ì „ì‹¬ë²•': { chukgi: 70, stability: 60, total: 130, type: 'ë¹„ì „' },
      'ëª…ìš´ì‹¬ë²•': { chukgi: 110, stability: 80, total: 190, type: 'ì‹ ê³µLv1' },
      'ë‹¬ë§ˆì‹¬ê³µ': { chukgi: 120, stability: 80, total: 200, type: 'ì‹ ê³µLv2' },
      'ì²œë§ˆì‹¬ê³µ': { chukgi: 130, stability: 70, total: 200, type: 'ì‹ ê³µLv2' }
    };
    
    const COMBAT_DISABLE = {
      'ê¸°ì´ˆ': 40, 'ê¸°ë³¸': 40, 'ì‹¬í™”': 40,
      'ë¹„ì „': 35, 'ì‹ ê³µLv1': 30, 'ì‹ ê³µLv2': 25
    };
    
    // ë„ì£¼ ê¶Œì¥ ê¸°ì¤€ (ì „íˆ¬ë¶ˆëŠ¥ + 10%)
    const FLEE_THRESHOLD_BONUS = 15;
    
    // ===== ì „íˆ¬ ìƒíƒœ =====
    let battleState = {
      round: 0,
      isRunning: false,
      autoInterval: null,
      attacker: { hp: 100, neigong: 100 },
      defender: { hp: 100, neigong: 100 },
      winner: null
    };
    
    // ===== ê³„ì‚° í•¨ìˆ˜ =====
    function getCharData(prefix) {
      const gyeongji = document.getElementById(`${prefix}-gyeongji`).value;
      const simbeop = document.getElementById(`${prefix}-simbeop`).value;
      const bobeop = parseInt(document.getElementById(`${prefix}-bobeop`).value);
      const ungi = parseInt(document.getElementById(`${prefix}-ungi`).value);
      const hp = battleState.round > 0 ? battleState[prefix === 'atk' ? 'attacker' : 'defender'].hp : parseInt(document.getElementById(`${prefix}-hp`).value);
      const neigong = battleState.round > 0 ? battleState[prefix === 'atk' ? 'attacker' : 'defender'].neigong : parseInt(document.getElementById(`${prefix}-neigong`).value);
      
      const g = GYEONGJI_DATA[gyeongji];
      const s = SIMBEOP_DATA[simbeop];
      
      const ungiGyeongro = Math.sqrt(s.chukgi);
      const danger = 1 / Math.sqrt(s.stability);
      const ungiRemain = 100 - ungi;
      const baseAttackTime = 3 / g.attackSpeed;
      
      // ë‚´ê³µ 70% ì´í•˜ ì†ë„ ê°ì†Œ
      let speedMod = 1;
      if (neigong < 70) speedMod -= (70 - neigong) * 0.03;
      const attackTime = baseAttackTime / Math.max(speedMod, 0.1);
      
      // ì´ë™ì†ë„ (ë³´ë²• ë ˆë²¨ ê¸°ì¤€)
      const moveSpeed = bobeop > 0 ? Math.sqrt(bobeop) : Math.sqrt(1);
      
      // ë³´ë²• ì¶”ê°€ í”¼í•´ (10% * ë ˆë²¨)
      const bobeopBonus = bobeop * 0.1;
      
      // ë‚´ê³µíŒŒê´´ë ¥
      let power = ungiGyeongro * (ungi / 100);
      if (hp < 80) power *= (1 - (80 - hp) * 0.03);
      
      // ë³´ë²• ì ìš© ì´ íŒŒê´´ë ¥
      const totalPower = power * (1 + bobeopBonus);
      
      // ì „íˆ¬ë¶ˆëŠ¥ ì„ê³„ê°’
      const threshold = COMBAT_DISABLE[s.type];
      
      // ë„ì£¼ ê¶Œì¥ ì—¬ë¶€
      const shouldFlee = neigong <= (threshold + FLEE_THRESHOLD_BONUS);
      
      return {
        name: document.getElementById(`${prefix}-name`).value,
        gyeongji, simbeop, bobeop, ungi, hp, neigong,
        g, s, ungiGyeongro, danger, ungiRemain, attackTime,
        moveSpeed, bobeopBonus, power, totalPower, threshold, shouldFlee,
        speedMod
      };
    }
    
    function updateDisplay(prefix) {
      const data = getCharData(prefix);
      const state = battleState[prefix === 'atk' ? 'attacker' : 'defender'];
      
      // ë¼ë²¨ ì—…ë°ì´íŠ¸
      document.getElementById(`${prefix}-gyeongji-label`).textContent = data.g.label;
      document.getElementById(`${prefix}-bobeop-label`).textContent = data.bobeop > 0 ? `Lv${data.bobeop}` : 'ì—†ìŒ';
      document.getElementById(`${prefix}-ungi-val`).textContent = data.ungi;
      
      // HP/ë‚´ê³µ ë°” ì—…ë°ì´íŠ¸
      const displayHp = battleState.round > 0 ? state.hp : data.hp;
      const displayNeigong = battleState.round > 0 ? state.neigong : data.neigong;
      
      document.getElementById(`${prefix}-hp-text`).textContent = `${displayHp.toFixed(1)} / 100`;
      document.getElementById(`${prefix}-hp-bar`).style.width = `${displayHp}%`;
      document.getElementById(`${prefix}-neigong-text`).textContent = `${displayNeigong.toFixed(1)} / 100`;
      document.getElementById(`${prefix}-neigong-bar`).style.width = `${displayNeigong}%`;
      
      // ê³„ì‚° ê²°ê³¼ ì—…ë°ì´íŠ¸
      document.getElementById(`${prefix}-calc-gyeongro`).textContent = data.ungiGyeongro.toFixed(2);
      document.getElementById(`${prefix}-calc-speed`).textContent = data.attackTime.toFixed(2);
      document.getElementById(`${prefix}-calc-move`).textContent = `âˆš${data.bobeop || 1}`;
      document.getElementById(`${prefix}-calc-bobeop`).textContent = `+${(data.bobeopBonus * 100).toFixed(0)}%`;
      document.getElementById(`${prefix}-calc-danger`).textContent = data.danger.toFixed(3);
      document.getElementById(`${prefix}-calc-threshold`).textContent = `${data.threshold}%`;
      document.getElementById(`${prefix}-calc-power`).textContent = data.power.toFixed(2);
      document.getElementById(`${prefix}-calc-total`).textContent = data.totalPower.toFixed(2);
      
      // ë„ì£¼ ê¶Œì¥ í‘œì‹œ
      const fleeEl = document.getElementById(`${prefix}-flee`);
      if (data.shouldFlee && battleState.round > 0) {
        fleeEl.style.display = 'block';
      } else {
        fleeEl.style.display = 'none';
      }
    }
    
    function updateAll() {
      updateDisplay('atk');
      updateDisplay('def');
    }
    
    // ===== ì „íˆ¬ ë¡œì§ =====
    function addLog(text, className = '') {
      const content = document.getElementById('log-content');
      const line = document.createElement('div');
      line.className = `log-line ${className}`;
      line.textContent = text;
      content.appendChild(line);
      content.scrollTop = content.scrollHeight;
    }
    
    function executeOneRound() {
      if (battleState.winner) return;
      
      battleState.round++;
      document.getElementById('round-num').textContent = battleState.round;
      
      // ì²« ë¼ìš´ë“œë©´ ì´ˆê¸°ê°’ ì„¤ì •
      if (battleState.round === 1) {
        battleState.attacker.hp = parseFloat(document.getElementById('atk-hp').value);
        battleState.attacker.neigong = parseFloat(document.getElementById('atk-neigong').value);
        battleState.defender.hp = parseFloat(document.getElementById('def-hp').value);
        battleState.defender.neigong = parseFloat(document.getElementById('def-neigong').value);
        document.getElementById('log-content').innerHTML = '';
      }
      
      const atk = getCharData('atk');
      const def = getCharData('def');
      
      addLog(`â•â•â•â•â•â• ì œ ${battleState.round} í•© â•â•â•â•â•â•`, 'round-title');
      
      // ì„ ê³µ ê²°ì • (ì´ë™ì†ë„ â†’ ê³µê²©ì†ë„)
      let firstAttacker, secondAttacker;
      if (atk.moveSpeed > def.moveSpeed) {
        firstAttacker = { ...atk, prefix: 'atk', state: battleState.attacker };
        secondAttacker = { ...def, prefix: 'def', state: battleState.defender };
      } else if (def.moveSpeed > atk.moveSpeed) {
        firstAttacker = { ...def, prefix: 'def', state: battleState.defender };
        secondAttacker = { ...atk, prefix: 'atk', state: battleState.attacker };
      } else {
        // ì´ë™ì†ë„ ê°™ìœ¼ë©´ ê³µê²©ì†ë„ë¡œ
        if (atk.attackTime <= def.attackTime) {
          firstAttacker = { ...atk, prefix: 'atk', state: battleState.attacker };
          secondAttacker = { ...def, prefix: 'def', state: battleState.defender };
        } else {
          firstAttacker = { ...def, prefix: 'def', state: battleState.defender };
          secondAttacker = { ...atk, prefix: 'atk', state: battleState.attacker };
        }
      }
      
      addLog(`ì„ ê³µ: ${firstAttacker.name} (ì´ì† âˆš${firstAttacker.bobeop || 1}, ê³µì† ${firstAttacker.attackTime.toFixed(2)}ì´ˆ)`, 'info');
      
      // ê²½ì§€/ì‹¬ë²• ë³´ì • ê³„ì‚°
      const gyeongjiDiff = firstAttacker.g.level - secondAttacker.g.level;
      let firstMod = 1, secondMod = 1;
      
      if (gyeongjiDiff > 0) secondMod -= gyeongjiDiff * 0.03;
      else if (gyeongjiDiff < 0) firstMod += gyeongjiDiff * 0.03;
      
      if (firstAttacker.s.total > secondAttacker.s.total) secondMod -= 0.03;
      else if (firstAttacker.s.total < secondAttacker.s.total) firstMod -= 0.03;
      
      // ì²« ë²ˆì§¸ ê³µê²©
      processAttack(firstAttacker, secondAttacker, firstMod, secondMod);
      
      // ë°©ì–´ì ìƒì¡´ ì²´í¬
      if (!checkCombatDisable(secondAttacker)) {
        // ë°˜ê²©
        processAttack(secondAttacker, firstAttacker, secondMod, firstMod);
        checkCombatDisable(firstAttacker);
      }
      
      // ìƒì‚¬ê²½/ìì—°ê²½ ë‚´ê³µ í¡ìˆ˜
      processNeigongDrain(atk, def);
      
      updateAll();
      
      // ìŠ¹ì ì²´í¬
      checkWinner();
    }
    
    function processAttack(attacker, defender, atkMod, defMod) {
      // ëª…ì¤‘ë¥  ì²´í¬ (ë‚´ê³µ 50% ì´í•˜)
      let hitChance = 100;
      if (attacker.state.neigong <= 50) {
        hitChance = 95 - (50 - attacker.state.neigong) * 5;
        hitChance = Math.max(hitChance, 5);
      }
      
      const isHit = Math.random() * 100 < hitChance;
      
      if (!isHit) {
        addLog(`${attacker.name}ì˜ ê³µê²©ì´ ë¹—ë‚˜ê°”ë‹¤! (ëª…ì¤‘ë¥ : ${hitChance.toFixed(0)}%)`, 'warning');
        // ë¹—ë‚˜ê°€ë©´ ê³µê²©ìë§Œ ë‚´ìƒ
        const selfDamage = attacker.ungiRemain * attacker.danger;
        attacker.state.hp -= selfDamage * 0.1;
        attacker.state.neigong -= selfDamage * 0.9;
        addLog(`  â”” ${attacker.name} ìí•´ ë‚´ìƒ: ì²´ë ¥ -${(selfDamage * 0.1).toFixed(2)}, ë‚´ê³µ -${(selfDamage * 0.9).toFixed(2)}`, 'danger');
        return;
      }
      
      // í”¼í•´ëŸ‰ ê³„ì‚°
      const baseDamage = attacker.totalPower * 10 * atkMod;
      const hpDamage = baseDamage * 0.2;
      const neigongDamage = baseDamage * 0.8;
      
      // í”¼í•´ ì ìš©
      defender.state.hp -= hpDamage;
      defender.state.neigong -= neigongDamage;
      
      addLog(`${attacker.name} â†’ ${defender.name}`, 'title');
      addLog(`  â”” í”¼í•´: ì²´ë ¥ -${hpDamage.toFixed(2)}, ë‚´ê³µ -${neigongDamage.toFixed(2)}`);
      
      // ê³µê²©ì ë‚´ìƒ (ìš´ê¸° ë¯¸ì™„ì„±)
      const atkNaesang = attacker.ungiRemain * attacker.danger;
      if (atkNaesang > 0) {
        attacker.state.hp -= atkNaesang * 0.1;
        attacker.state.neigong -= atkNaesang * 0.9;
        addLog(`  â”” ${attacker.name} ìš´ê¸°ë‚´ìƒ: ì²´ë ¥ -${(atkNaesang * 0.1).toFixed(2)}, ë‚´ê³µ -${(atkNaesang * 0.9).toFixed(2)}`, 'warning');
      }
      
      // ë°©ì–´ì ë‚´ìƒ
      const defNaesang = defender.ungiRemain * defender.danger;
      if (defNaesang > 0) {
        defender.state.hp -= defNaesang * 0.1;
        defender.state.neigong -= defNaesang * 0.9;
        addLog(`  â”” ${defender.name} ë°©ì–´ë‚´ìƒ: ì²´ë ¥ -${(defNaesang * 0.1).toFixed(2)}, ë‚´ê³µ -${(defNaesang * 0.9).toFixed(2)}`, 'warning');
      }
      
      // ìƒíƒœ ìµœì†Œê°’ ë³´ì •
      attacker.state.hp = Math.max(0, attacker.state.hp);
      attacker.state.neigong = Math.max(0, attacker.state.neigong);
      defender.state.hp = Math.max(0, defender.state.hp);
      defender.state.neigong = Math.max(0, defender.state.neigong);
    }
    
    function processNeigongDrain(atk, def) {
      // ìƒì‚¬ê²½: 0.5% í¡ìˆ˜, ìì—°ê²½: 1% í¡ìˆ˜
      const atkLevel = atk.g.level;
      const defLevel = def.g.level;
      
      if (atkLevel >= 8 && defLevel < atkLevel) {
        const drainRate = atkLevel === 9 ? 0.01 : 0.005;
        const drain = battleState.defender.neigong * drainRate;
        battleState.defender.neigong -= drain;
        battleState.attacker.neigong = Math.min(100, battleState.attacker.neigong + drain);
        addLog(`${atk.name}(${atk.gyeongji}) ë‚´ê³µ í¡ìˆ˜: +${drain.toFixed(2)}`, 'success');
      }
      
      if (defLevel >= 8 && atkLevel < defLevel) {
        const drainRate = defLevel === 9 ? 0.01 : 0.005;
        const drain = battleState.attacker.neigong * drainRate;
        battleState.attacker.neigong -= drain;
        battleState.defender.neigong = Math.min(100, battleState.defender.neigong + drain);
        addLog(`${def.name}(${def.gyeongji}) ë‚´ê³µ í¡ìˆ˜: +${drain.toFixed(2)}`, 'success');
      }
    }
    
    function checkCombatDisable(char) {
      if (char.state.neigong <= char.threshold || char.state.hp <= 0) {
        addLog(`ğŸ’€ ${char.name} ì „íˆ¬ë¶ˆëŠ¥! (ë‚´ê³µ: ${char.state.neigong.toFixed(1)}%, ì„ê³„: ${char.threshold}%)`, 'danger');
        return true;
      }
      
      // ë„ì£¼ ê¶Œì¥ ì²´í¬
      if (char.state.neigong <= char.threshold + FLEE_THRESHOLD_BONUS) {
        addLog(`âš ï¸ ${char.name}ì—ê²Œ ë„ì£¼ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤! (ë‚´ê³µ: ${char.state.neigong.toFixed(1)}%)`, 'warning');
      }
      
      return false;
    }
    
    function checkWinner() {
      const atkData = getCharData('atk');
      const defData = getCharData('def');
      
      const atkDisabled = battleState.attacker.neigong <= atkData.threshold || battleState.attacker.hp <= 0;
      const defDisabled = battleState.defender.neigong <= defData.threshold || battleState.defender.hp <= 0;
      
      if (atkDisabled && defDisabled) {
        battleState.winner = 'draw';
        showResult('âš”ï¸ ìŒë°© ì „íˆ¬ë¶ˆëŠ¥ - ë¬´ìŠ¹ë¶€!', 'result-draw');
      } else if (atkDisabled) {
        battleState.winner = 'defender';
        showResult(`ğŸ† ${defData.name} ìŠ¹ë¦¬! (${battleState.round}í•©)`, 'result-winner');
      } else if (defDisabled) {
        battleState.winner = 'attacker';
        showResult(`ğŸ† ${atkData.name} ìŠ¹ë¦¬! (${battleState.round}í•©)`, 'result-winner');
      }
      
      if (battleState.winner) {
        stopAutoBattle();
      }
    }
    
    function showResult(text, className) {
      const resultEl = document.getElementById('battle-result');
      const textEl = document.getElementById('result-text');
      resultEl.style.display = 'block';
      textEl.className = `result-text ${className}`;
      textEl.textContent = text;
      
      addLog('', 'divider');
      addLog(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`, 'divider');
      addLog(text, className === 'result-winner' ? 'success' : 'info');
    }
    
    // ===== ìë™ ì „íˆ¬ =====
    function startAutoBattle() {
      if (battleState.winner) return;
      
      battleState.isRunning = true;
      document.getElementById('btn-auto').style.display = 'none';
      document.getElementById('btn-stop').style.display = 'inline-block';
      
      battleState.autoInterval = setInterval(() => {
        if (battleState.winner) {
          stopAutoBattle();
          return;
        }
        executeOneRound();
      }, 800);
    }
    
    function stopAutoBattle() {
      battleState.isRunning = false;
      if (battleState.autoInterval) {
        clearInterval(battleState.autoInterval);
        battleState.autoInterval = null;
      }
      document.getElementById('btn-auto').style.display = 'inline-block';
      document.getElementById('btn-stop').style.display = 'none';
    }
    
    function resetBattle() {
      stopAutoBattle();
      
      battleState = {
        round: 0,
        isRunning: false,
        autoInterval: null,
        attacker: { hp: 100, neigong: 100 },
        defender: { hp: 100, neigong: 100 },
        winner: null
      };
      
      // ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
      document.getElementById('atk-hp').value = 100;
      document.getElementById('atk-neigong').value = 100;
      document.getElementById('def-hp').value = 100;
      document.getElementById('def-neigong').value = 100;
      
      document.getElementById('round-num').textContent = '0';
      document.getElementById('log-content').innerHTML = '<div class="log-line info">ì „íˆ¬ë¥¼ ì‹œì‘í•˜ë ¤ë©´ [1í•©] ë˜ëŠ” [ìë™ ì „íˆ¬] ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>';
      document.getElementById('battle-result').style.display = 'none';
      
      updateAll();
    }
    
    // ì´ˆê¸°í™”
    updateAll();
  </script>
</body>
</html>
