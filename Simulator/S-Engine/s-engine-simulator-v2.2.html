<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S-Engine æˆ°é¬ª è©¦æ¼”å™¨</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Serif+KR:wght@600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      min-height: 100vh;
      background: linear-gradient(180deg, #0a0a0f 0%, #1a1a2e 50%, #0a0a0f 100%);
      color: #e0e0e0;
      font-family: 'Noto Sans KR', -apple-system, sans-serif;
      padding: 40px 20px;
    }
    
    .container { max-width: 1200px; margin: 0 auto; }
    
    header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    h1 {
      font-family: 'Noto Serif KR', serif;
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #ffd700 0%, #ff6b35 50%, #ffd700 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }
    
    .subtitle { color: #888; font-size: 0.95rem; }
    
    .panels {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 32px;
    }
    
    .panel {
      border-radius: 16px;
      padding: 24px;
      flex: 1;
      min-width: 320px;
      max-width: 450px;
    }
    
    .panel.attacker {
      background: linear-gradient(135deg, rgba(231,76,60,0.08) 0%, rgba(231,76,60,0.02) 100%);
      border: 2px solid rgba(231,76,60,0.25);
    }
    
    .panel.defender {
      background: linear-gradient(135deg, rgba(52,152,219,0.08) 0%, rgba(52,152,219,0.02) 100%);
      border: 2px solid rgba(52,152,219,0.25);
    }
    
    .panel h2 {
      font-family: 'Noto Serif KR', serif;
      font-size: 1.5rem;
      text-align: center;
      margin-bottom: 20px;
      text-shadow: 0 0 20px currentColor;
    }
    
    .panel.attacker h2 { color: #e74c3c; }
    .panel.defender h2 { color: #3498db; }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    label {
      display: block;
      margin-bottom: 6px;
      color: #a0a0a0;
      font-size: 0.85rem;
    }
    
    label .highlight-red { color: #e74c3c; }
    label .highlight-blue { color: #3498db; }
    
    input[type="text"], select {
      width: 100%;
      padding: 10px 14px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: #fff;
      font-size: 1rem;
      font-family: inherit;
    }
    
    input[type="range"] {
      width: 100%;
      margin-top: 4px;
    }
    
    .range-row {
      display: flex;
      gap: 12px;
    }
    
    .range-row > div { flex: 1; }
    
    .calc-result {
      margin-top: 12px;
      padding: 16px;
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      font-size: 0.85rem;
    }
    
    .calc-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    
    .calc-grid .full { grid-column: 1 / -1; }
    
    .buttons {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .btn-battle {
      padding: 16px 48px;
      font-size: 1.2rem;
      font-weight: bold;
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      border: none;
      border-radius: 12px;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(231,76,60,0.4);
      transition: all 0.3s ease;
    }
    
    .btn-battle:hover { transform: scale(1.05); }
    
    .btn-formula {
      margin-left: 16px;
      padding: 16px 32px;
      font-size: 1rem;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 12px;
      color: #aaa;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-formula:hover { background: rgba(255,255,255,0.15); }
    
    .formula-box {
      max-width: 800px;
      margin: 0 auto 32px;
      padding: 24px;
      background: rgba(255,215,0,0.05);
      border: 1px solid rgba(255,215,0,0.2);
      border-radius: 16px;
      font-size: 0.9rem;
      font-family: monospace;
      display: none;
    }
    
    .formula-box.show { display: block; }
    
    .formula-box h3 {
      color: #ffd700;
      margin-bottom: 16px;
    }
    
    .formula-list {
      display: grid;
      gap: 8px;
      color: #ccc;
    }
    
    .formula-list .note {
      margin-top: 8px;
      color: #888;
    }
    
    .battle-log {
      max-width: 600px;
      margin: 0 auto;
      padding: 24px;
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      font-family: monospace;
      font-size: 0.95rem;
      display: none;
    }
    
    .battle-log.show { display: block; }
    
    .battle-log h3 {
      color: #ffd700;
      margin-bottom: 16px;
      font-family: 'Noto Serif KR', serif;
    }
    
    .log-line { margin-bottom: 4px; color: #ccc; }
    .log-line.title { color: #ffd700; }
    .log-line.danger { color: #e74c3c; }
    
    footer {
      text-align: center;
      margin-top: 48px;
      color: #555;
      font-size: 0.85rem;
    }
    
    @media (max-width: 768px) {
      h1 { font-size: 1.8rem; }
      .panels { flex-direction: column; }
      .panel { max-width: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>S-Engine æˆ°é¬ª è©¦æ¼”å™¨</h1>
      <p class="subtitle">ë¬´í˜‘ ì„¸ê³„ê´€ ì „íˆ¬ ì‹œë®¬ë ˆì´í„° v2.2</p>
    </header>
    
    <div class="panels">
      <!-- ê³µê²©ì íŒ¨ë„ -->
      <div class="panel attacker">
        <h2>âš”ï¸ ê³µê²©ì</h2>
        
        <div class="form-group">
          <label>ì´ë¦„</label>
          <input type="text" id="atk-name" value="ê³µê²©ì">
        </div>
        
        <div class="form-group">
          <label>ê²½ì§€ <span class="highlight-red" id="atk-gyeongji-label">çµ¶é ‚</span></label>
          <select id="atk-gyeongji">
            <option value="ì‚¼ë¥˜">ì‚¼ë¥˜ (ä¸‰æµ)</option>
            <option value="ì´ë¥˜">ì´ë¥˜ (äºŒæµ)</option>
            <option value="ì¼ë¥˜">ì¼ë¥˜ (ä¸€æµ)</option>
            <option value="ì ˆì •" selected>ì ˆì • (çµ¶é ‚)</option>
            <option value="ì´ˆì ˆì •">ì´ˆì ˆì • (è¶…çµ¶é ‚)</option>
            <option value="í™”ê²½">í™”ê²½ (åŒ–å¢ƒ)</option>
            <option value="í˜„ê²½">í˜„ê²½ (ç„å¢ƒ)</option>
            <option value="ìƒì‚¬ê²½">ìƒì‚¬ê²½ (ç”Ÿæ­»å¢ƒ)</option>
            <option value="ìì—°ê²½">ìì—°ê²½ (è‡ªç„¶å¢ƒ)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì‹¬ë²•</label>
          <select id="atk-simbeop">
            <option value="ì‚¼ì¬ì‹¬ë²•">ì‚¼ì¬ì‹¬ë²• (ì¶•10/ì•ˆ90)</option>
            <option value="ê¸°ì´ˆì‹¬ë²•">ê¸°ì´ˆì‹¬ë²• (ì¶•20/ì•ˆ80)</option>
            <option value="ê¸°ë³¸ì‹¬ë²•" selected>ê¸°ë³¸ì‹¬ë²• (ì¶•30/ì•ˆ70)</option>
            <option value="ì‹¬í™”ì‹¬ë²•">ì‹¬í™”ì‹¬ë²• (ì¶•40/ì•ˆ70)</option>
            <option value="ë¹„ì „ì‹¬ë²•">ë¹„ì „ì‹¬ë²• (ì¶•70/ì•ˆ60)</option>
            <option value="ëª…ìš´ì‹¬ë²•">ëª…ìš´ì‹¬ë²• (ì¶•110/ì•ˆ80)</option>
            <option value="ë‹¬ë§ˆì‹¬ê³µ">ë‹¬ë§ˆì‹¬ê³µ (ì¶•120/ì•ˆ80)</option>
            <option value="ì²œë§ˆì‹¬ê³µ">ì²œë§ˆì‹¬ê³µ (ì¶•130/ì•ˆ70)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ìš´ê¸°ì§„í–‰ë„: <span id="atk-ungi-val">100</span>%</label>
          <input type="range" id="atk-ungi" min="80" max="100" value="100" style="accent-color: #e74c3c;">
        </div>
        
        <div class="form-group range-row">
          <div>
            <label>ì²´ë ¥: <span id="atk-hp-val">100</span>%</label>
            <input type="range" id="atk-hp" min="1" max="100" value="100" style="accent-color: #e74c3c;">
          </div>
          <div>
            <label>ë‚´ê³µ: <span id="atk-neigong-val">100</span>%</label>
            <input type="range" id="atk-neigong" min="1" max="100" value="100" style="accent-color: #3498db;">
          </div>
        </div>
        
        <div class="calc-result">
          <div class="calc-grid">
            <div>ìš´ê¸°ê²½ë¡œ: <span class="highlight-red" id="atk-calc-gyeongro">5.48</span></div>
            <div>ìš´ê¸°ìœ„í—˜ì„±: <span class="highlight-red" id="atk-calc-danger">0.120</span></div>
            <div>ê³µê²©ì†ë„: <span class="highlight-red" id="atk-calc-speed">1.50</span>ì´ˆ</div>
            <div>ìš´ê¸°ì”ì—¬ë„: <span class="highlight-red" id="atk-calc-remain">0</span>%</div>
            <div class="full">ë‚´ê³µíŒŒê´´ë ¥: <span class="highlight-red" style="font-size:1.1rem;font-weight:bold" id="atk-calc-power">5.48</span></div>
          </div>
        </div>
      </div>
      
      <!-- ë°©ì–´ì íŒ¨ë„ -->
      <div class="panel defender">
        <h2>ğŸ›¡ï¸ ë°©ì–´ì</h2>
        
        <div class="form-group">
          <label>ì´ë¦„</label>
          <input type="text" id="def-name" value="ë°©ì–´ì">
        </div>
        
        <div class="form-group">
          <label>ê²½ì§€ <span class="highlight-blue" id="def-gyeongji-label">ä¸€æµ</span></label>
          <select id="def-gyeongji">
            <option value="ì‚¼ë¥˜">ì‚¼ë¥˜ (ä¸‰æµ)</option>
            <option value="ì´ë¥˜">ì´ë¥˜ (äºŒæµ)</option>
            <option value="ì¼ë¥˜" selected>ì¼ë¥˜ (ä¸€æµ)</option>
            <option value="ì ˆì •">ì ˆì • (çµ¶é ‚)</option>
            <option value="ì´ˆì ˆì •">ì´ˆì ˆì • (è¶…çµ¶é ‚)</option>
            <option value="í™”ê²½">í™”ê²½ (åŒ–å¢ƒ)</option>
            <option value="í˜„ê²½">í˜„ê²½ (ç„å¢ƒ)</option>
            <option value="ìƒì‚¬ê²½">ìƒì‚¬ê²½ (ç”Ÿæ­»å¢ƒ)</option>
            <option value="ìì—°ê²½">ìì—°ê²½ (è‡ªç„¶å¢ƒ)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ì‹¬ë²•</label>
          <select id="def-simbeop">
            <option value="ì‚¼ì¬ì‹¬ë²•">ì‚¼ì¬ì‹¬ë²• (ì¶•10/ì•ˆ90)</option>
            <option value="ê¸°ì´ˆì‹¬ë²•" selected>ê¸°ì´ˆì‹¬ë²• (ì¶•20/ì•ˆ80)</option>
            <option value="ê¸°ë³¸ì‹¬ë²•">ê¸°ë³¸ì‹¬ë²• (ì¶•30/ì•ˆ70)</option>
            <option value="ì‹¬í™”ì‹¬ë²•">ì‹¬í™”ì‹¬ë²• (ì¶•40/ì•ˆ70)</option>
            <option value="ë¹„ì „ì‹¬ë²•">ë¹„ì „ì‹¬ë²• (ì¶•70/ì•ˆ60)</option>
            <option value="ëª…ìš´ì‹¬ë²•">ëª…ìš´ì‹¬ë²• (ì¶•110/ì•ˆ80)</option>
            <option value="ë‹¬ë§ˆì‹¬ê³µ">ë‹¬ë§ˆì‹¬ê³µ (ì¶•120/ì•ˆ80)</option>
            <option value="ì²œë§ˆì‹¬ê³µ">ì²œë§ˆì‹¬ê³µ (ì¶•130/ì•ˆ70)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>ìš´ê¸°ì§„í–‰ë„: <span id="def-ungi-val">85</span>%</label>
          <input type="range" id="def-ungi" min="80" max="100" value="85" style="accent-color: #3498db;">
        </div>
        
        <div class="form-group range-row">
          <div>
            <label>ì²´ë ¥: <span id="def-hp-val">100</span>%</label>
            <input type="range" id="def-hp" min="1" max="100" value="100" style="accent-color: #e74c3c;">
          </div>
          <div>
            <label>ë‚´ê³µ: <span id="def-neigong-val">100</span>%</label>
            <input type="range" id="def-neigong" min="1" max="100" value="100" style="accent-color: #3498db;">
          </div>
        </div>
        
        <div class="calc-result">
          <div class="calc-grid">
            <div>ìš´ê¸°ê²½ë¡œ: <span class="highlight-blue" id="def-calc-gyeongro">4.47</span></div>
            <div>ìš´ê¸°ìœ„í—˜ì„±: <span class="highlight-blue" id="def-calc-danger">0.112</span></div>
            <div>ê³µê²©ì†ë„: <span class="highlight-blue" id="def-calc-speed">1.73</span>ì´ˆ</div>
            <div>ìš´ê¸°ì”ì—¬ë„: <span class="highlight-blue" id="def-calc-remain">15</span>%</div>
            <div class="full">ë‚´ê³µíŒŒê´´ë ¥: <span class="highlight-blue" style="font-size:1.1rem;font-weight:bold" id="def-calc-power">3.80</span></div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="buttons">
      <button class="btn-battle" onclick="executeBattle()">âš”ï¸ ì¼í•© ê³„ì‚°</button>
      <button class="btn-formula" onclick="toggleFormula()">ğŸ“ ê³µì‹ ë³´ê¸°</button>
    </div>
    
    <div class="formula-box" id="formula-box">
      <h3>ğŸ“ S-Engine í•µì‹¬ ê³µì‹</h3>
      <div class="formula-list">
        <div>ìš´ê¸°ê²½ë¡œ = âˆšì¶•ê¸°ì†ë„</div>
        <div>ìš´ê¸°ìœ„í—˜ì„± = 1 Ã· âˆšì•ˆì •ì„±</div>
        <div>ìš´ê¸°ì”ì—¬ë„ = 100 - ìš´ê¸°ì§„í–‰ë„</div>
        <div>ë‚´ê³µë¬´ê³µíŒŒê´´ë ¥ = ìš´ê¸°ê²½ë¡œ Ã— (ìš´ê¸°ì§„í–‰ë„ Ã· 100)</div>
        <div>ì†Œì§„ë‚´ê³µ = ìš´ê¸°ì§„í–‰ë„ Ã— ìš´ê¸°ìœ„í—˜ì„±</div>
        <div>ë‚´ìƒë‚´ê³µ = ìš´ê¸°ì”ì—¬ë„ Ã— ìš´ê¸°ìœ„í—˜ì„±</div>
        <div class="note">í”¼í•´ë¶„ë°°: ì²´ë ¥ 20% / ë‚´ê³µ 80%</div>
        <div class="note">ë‚´ìƒë¶„ë°°: ì²´ë ¥ 10% / ë‚´ê³µ 90%</div>
      </div>
    </div>
    
    <div class="battle-log" id="battle-log">
      <h3>ğŸ“œ ì „íˆ¬ ê¸°ë¡</h3>
      <div id="log-content"></div>
    </div>
    
    <footer>
      S-Engine Combat Simulator by ShadowK
    </footer>
  </div>
  
  <script>
    // ê²½ì§€ ë°ì´í„°
    const GYEONGJI_DATA = {
      'ì‚¼ë¥˜': { level: 1, attackSpeed: Math.sqrt(1), label: 'ä¸‰æµ' },
      'ì´ë¥˜': { level: 2, attackSpeed: Math.sqrt(2), label: 'äºŒæµ' },
      'ì¼ë¥˜': { level: 3, attackSpeed: Math.sqrt(3), label: 'ä¸€æµ' },
      'ì ˆì •': { level: 4, attackSpeed: Math.sqrt(4), label: 'çµ¶é ‚' },
      'ì´ˆì ˆì •': { level: 5, attackSpeed: Math.sqrt(5), label: 'è¶…çµ¶é ‚' },
      'í™”ê²½': { level: 6, attackSpeed: Math.sqrt(6), label: 'åŒ–å¢ƒ' },
      'í˜„ê²½': { level: 7, attackSpeed: Math.sqrt(7), label: 'ç„å¢ƒ' },
      'ìƒì‚¬ê²½': { level: 8, attackSpeed: Math.sqrt(8), label: 'ç”Ÿæ­»å¢ƒ' },
      'ìì—°ê²½': { level: 9, attackSpeed: Math.sqrt(9), label: 'è‡ªç„¶å¢ƒ' }
    };
    
    // ì‹¬ë²• ë°ì´í„°
    const SIMBEOP_DATA = {
      'ì‚¼ì¬ì‹¬ë²•': { chukgi: 10, stability: 90, total: 100, type: 'ê¸°ë³¸' },
      'ê¸°ì´ˆì‹¬ë²•': { chukgi: 20, stability: 80, total: 100, type: 'ê¸°ì´ˆ' },
      'ê¸°ë³¸ì‹¬ë²•': { chukgi: 30, stability: 70, total: 100, type: 'ê¸°ë³¸' },
      'ì‹¬í™”ì‹¬ë²•': { chukgi: 40, stability: 70, total: 110, type: 'ì‹¬í™”' },
      'ë¹„ì „ì‹¬ë²•': { chukgi: 70, stability: 60, total: 130, type: 'ë¹„ì „' },
      'ëª…ìš´ì‹¬ë²•': { chukgi: 110, stability: 80, total: 190, type: 'ì‹ ê³µLv1' },
      'ë‹¬ë§ˆì‹¬ê³µ': { chukgi: 120, stability: 80, total: 200, type: 'ì‹ ê³µLv2' },
      'ì²œë§ˆì‹¬ê³µ': { chukgi: 130, stability: 70, total: 200, type: 'ì‹ ê³µLv2' }
    };
    
    // ì „íˆ¬ë¶ˆëŠ¥ ê¸°ì¤€
    const COMBAT_DISABLE = {
      'ê¸°ì´ˆ': 40, 'ê¸°ë³¸': 40, 'ì‹¬í™”': 40,
      'ë¹„ì „': 35,
      'ì‹ ê³µLv1': 30,
      'ì‹ ê³µLv2': 25
    };
    
    // ê³„ì‚° í•¨ìˆ˜
    function updateCalc(prefix) {
      const gyeongji = document.getElementById(`${prefix}-gyeongji`).value;
      const simbeop = document.getElementById(`${prefix}-simbeop`).value;
      const ungi = parseInt(document.getElementById(`${prefix}-ungi`).value);
      const hp = parseInt(document.getElementById(`${prefix}-hp`).value);
      
      const g = GYEONGJI_DATA[gyeongji];
      const s = SIMBEOP_DATA[simbeop];
      
      const ungiGyeongro = Math.sqrt(s.chukgi);
      const danger = 1 / Math.sqrt(s.stability);
      const ungiRemain = 100 - ungi;
      const attackTime = 3 / g.attackSpeed;
      
      let power = ungiGyeongro * (ungi / 100);
      if (hp < 80) {
        power *= (1 - (80 - hp) * 0.03);
      }
      
      // ë¼ë²¨ ì—…ë°ì´íŠ¸
      document.getElementById(`${prefix}-gyeongji-label`).textContent = g.label;
      document.getElementById(`${prefix}-ungi-val`).textContent = ungi;
      document.getElementById(`${prefix}-hp-val`).textContent = hp;
      document.getElementById(`${prefix}-neigong-val`).textContent = 
        document.getElementById(`${prefix}-neigong`).value;
      
      // ê³„ì‚° ê²°ê³¼ ì—…ë°ì´íŠ¸
      document.getElementById(`${prefix}-calc-gyeongro`).textContent = ungiGyeongro.toFixed(2);
      document.getElementById(`${prefix}-calc-danger`).textContent = danger.toFixed(3);
      document.getElementById(`${prefix}-calc-speed`).textContent = attackTime.toFixed(2);
      document.getElementById(`${prefix}-calc-remain`).textContent = ungiRemain;
      document.getElementById(`${prefix}-calc-power`).textContent = power.toFixed(2);
    }
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    ['atk', 'def'].forEach(prefix => {
      ['gyeongji', 'simbeop', 'ungi', 'hp', 'neigong'].forEach(field => {
        document.getElementById(`${prefix}-${field}`).addEventListener('input', () => updateCalc(prefix));
      });
    });
    
    // ì´ˆê¸° ê³„ì‚°
    updateCalc('atk');
    updateCalc('def');
    
    // ê³µì‹ í† ê¸€
    function toggleFormula() {
      document.getElementById('formula-box').classList.toggle('show');
    }
    
    // ì „íˆ¬ ì‹¤í–‰
    function executeBattle() {
      const atkName = document.getElementById('atk-name').value;
      const defName = document.getElementById('def-name').value;
      const atkGyeongji = document.getElementById('atk-gyeongji').value;
      const defGyeongji = document.getElementById('def-gyeongji').value;
      const atkSimbeop = document.getElementById('atk-simbeop').value;
      const defSimbeop = document.getElementById('def-simbeop').value;
      const atkUngi = parseInt(document.getElementById('atk-ungi').value);
      const defUngi = parseInt(document.getElementById('def-ungi').value);
      const atkHp = parseInt(document.getElementById('atk-hp').value);
      const defHp = parseInt(document.getElementById('def-hp').value);
      const atkNeigong = parseInt(document.getElementById('atk-neigong').value);
      const defNeigong = parseInt(document.getElementById('def-neigong').value);
      
      const atkG = GYEONGJI_DATA[atkGyeongji];
      const defG = GYEONGJI_DATA[defGyeongji];
      const atkS = SIMBEOP_DATA[atkSimbeop];
      const defS = SIMBEOP_DATA[defSimbeop];
      
      // ê²½ì§€/ì‹¬ë²• ë³´ì •
      const gyeongjiDiff = atkG.level - defG.level;
      let atkMod = 1, defMod = 1;
      
      if (gyeongjiDiff > 0) defMod -= gyeongjiDiff * 0.03;
      else if (gyeongjiDiff < 0) atkMod += gyeongjiDiff * 0.03;
      
      if (atkS.total > defS.total) defMod -= 0.03;
      else if (atkS.total < defS.total) atkMod -= 0.03;
      
      // ì†ë„ ë³´ì •
      let atkSpeedMod = 1, defSpeedMod = 1;
      if (atkNeigong < 70) atkSpeedMod -= (70 - atkNeigong) * 0.03;
      if (defNeigong < 70) defSpeedMod -= (70 - defNeigong) * 0.03;
      
      // ë‚´ê³µíŒŒê´´ë ¥ ê³„ì‚°
      const atkUngiGyeongro = Math.sqrt(atkS.chukgi);
      const defUngiGyeongro = Math.sqrt(defS.chukgi);
      const atkDanger = 1 / Math.sqrt(atkS.stability);
      const defDanger = 1 / Math.sqrt(defS.stability);
      
      let atkPower = atkUngiGyeongro * (atkUngi / 100);
      if (atkHp < 80) atkPower *= (1 - (80 - atkHp) * 0.03);
      
      // í”¼í•´ëŸ‰ ê³„ì‚°
      const baseDamage = atkPower * 10;
      const finalDamage = baseDamage * atkMod;
      const hpDamage = finalDamage * 0.2;
      const neigongDamage = finalDamage * 0.8;
      
      // ë‚´ìƒ ê³„ì‚°
      const atkUngiRemain = 100 - atkUngi;
      const defUngiRemain = 100 - defUngi;
      const atkNaesang = atkUngiRemain * atkDanger;
      const defNaesang = defUngiRemain * defDanger;
      
      // ê³µê²© ì†ë„
      const atkSpeed = (3 / atkG.attackSpeed) * atkSpeedMod;
      const defSpeed = (3 / defG.attackSpeed) * defSpeedMod;
      
      // ì „íˆ¬ë¶ˆëŠ¥ ì²´í¬
      const threshold = COMBAT_DISABLE[defS.type];
      const newDefNeigong = defNeigong - (neigongDamage / 10) - (defNaesang * 0.9);
      const isDisabled = newDefNeigong <= threshold;
      
      // ë¡œê·¸ ìƒì„±
      const logs = [
        { text: `âš”ï¸ ${atkName}(${atkGyeongji}) vs ${defName}(${defGyeongji})`, class: 'title' },
        { text: 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€' },
        { text: `ğŸ“Š ê²½ì§€ ì°¨ì´: ${gyeongjiDiff > 0 ? '+' : ''}${gyeongjiDiff}ë‹¨ê³„` },
        { text: `ğŸ¯ ê³µê²©ì ë³´ì •: ${(atkMod * 100).toFixed(1)}%` },
        { text: `ğŸ›¡ï¸ ë°©ì–´ì ë³´ì •: ${(defMod * 100).toFixed(1)}%` },
        { text: 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€' },
        { text: `ğŸ’¥ ê¸°ë³¸ í”¼í•´ëŸ‰: ${baseDamage.toFixed(2)}` },
        { text: `ğŸ’¥ ìµœì¢… í”¼í•´ëŸ‰: ${finalDamage.toFixed(2)}` },
        { text: `   â”œ ì²´ë ¥ í”¼í•´: ${hpDamage.toFixed(2)}` },
        { text: `   â”” ë‚´ê³µ í”¼í•´: ${neigongDamage.toFixed(2)}` },
        { text: 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€' },
        { text: `ğŸ©¸ ê³µê²©ì ë‚´ìƒ:` },
        { text: `   â”œ ì²´ë ¥: -${(atkNaesang * 0.1).toFixed(2)}` },
        { text: `   â”” ë‚´ê³µ: -${(atkNaesang * 0.9).toFixed(2)}` },
        { text: `ğŸ©¸ ë°©ì–´ì ë‚´ìƒ:` },
        { text: `   â”œ ì²´ë ¥: -${(defNaesang * 0.1).toFixed(2)}` },
        { text: `   â”” ë‚´ê³µ: -${(defNaesang * 0.9).toFixed(2)}` },
        { text: 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€' },
        { text: `â±ï¸ ê³µê²© ì†ë„: ${atkSpeed.toFixed(2)}ì´ˆ vs ${defSpeed.toFixed(2)}ì´ˆ` }
      ];
      
      if (isDisabled) {
        logs.push({ text: 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€' });
        logs.push({ text: `ğŸ³ï¸ ${defName} ì „íˆ¬ë¶ˆëŠ¥! (ì„ê³„ê°’: ${threshold}%)`, class: 'danger' });
      }
      
      // ë¡œê·¸ ì¶œë ¥
      const logContent = document.getElementById('log-content');
      logContent.innerHTML = logs.map(l => 
        `<div class="log-line ${l.class || ''}">${l.text}</div>`
      ).join('');
      
      document.getElementById('battle-log').classList.add('show');
    }
  </script>
</body>
</html>
