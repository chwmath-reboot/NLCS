<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S-Engine æˆ°é¬ª è©¦æ¼”å™¨ v3</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Serif+KR:wght@600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      min-height: 100vh;
      background: linear-gradient(180deg, #0a0a0f 0%, #1a1a2e 50%, #0a0a0f 100%);
      color: #e0e0e0;
      font-family: 'Noto Sans KR', -apple-system, sans-serif;
      padding: 20px 15px;
    }
    
    .container { max-width: 1500px; margin: 0 auto; }
    
    header { text-align: center; margin-bottom: 20px; }
    
    h1 {
      font-family: 'Noto Serif KR', serif;
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, #ffd700 0%, #ff6b35 50%, #ffd700 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 4px;
    }
    
    .subtitle { color: #888; font-size: 0.85rem; }
    
    .main-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    @media (max-width: 1200px) {
      .main-layout { grid-template-columns: 1fr; }
    }
    
    .panels { display: flex; flex-direction: column; gap: 12px; }
    
    .panel {
      border-radius: 10px;
      padding: 16px;
    }
    
    .panel.attacker {
      background: linear-gradient(135deg, rgba(231,76,60,0.08) 0%, rgba(231,76,60,0.02) 100%);
      border: 2px solid rgba(231,76,60,0.25);
    }
    
    .panel.defender {
      background: linear-gradient(135deg, rgba(52,152,219,0.08) 0%, rgba(52,152,219,0.02) 100%);
      border: 2px solid rgba(52,152,219,0.25);
    }
    
    .panel h2 {
      font-family: 'Noto Serif KR', serif;
      font-size: 1.2rem;
      text-align: center;
      margin-bottom: 12px;
    }
    
    .panel.attacker h2 { color: #e74c3c; }
    .panel.defender h2 { color: #3498db; }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .form-row.skills {
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    }
    
    label {
      display: block;
      margin-bottom: 3px;
      color: #a0a0a0;
      font-size: 0.75rem;
    }
    
    .highlight-red { color: #e74c3c; }
    .highlight-blue { color: #3498db; }
    .highlight-gold { color: #ffd700; }
    .highlight-green { color: #2ecc71; }
    .highlight-purple { color: #9b59b6; }
    
    input[type="text"], select {
      width: 100%;
      padding: 6px 8px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 5px;
      color: #fff;
      font-size: 0.85rem;
      font-family: inherit;
    }
    
    select option { background: #1a1a2e; }
    
    input[type="range"] {
      width: 100%;
      margin-top: 2px;
    }
    
    .section-title {
      font-size: 0.8rem;
      color: #ffd700;
      margin: 12px 0 8px;
      padding-bottom: 4px;
      border-bottom: 1px solid rgba(255,215,0,0.3);
    }
    
    .status-bars {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    
    .status-bar {
      background: rgba(0,0,0,0.3);
      border-radius: 6px;
      padding: 6px 10px;
    }
    
    .bar-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      margin-bottom: 3px;
    }
    
    .bar-track {
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      overflow: hidden;
    }
    
    .bar-fill {
      height: 100%;
      transition: width 0.3s ease;
    }
    
    .bar-fill.hp { background: linear-gradient(90deg, #c0392b, #e74c3c); }
    .bar-fill.neigong { background: linear-gradient(90deg, #2980b9, #3498db); }
    
    .calc-result {
      margin-top: 10px;
      padding: 10px;
      background: rgba(0,0,0,0.2);
      border-radius: 6px;
      font-size: 0.75rem;
    }
    
    .calc-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 4px;
    }
    
    .calc-grid .full { grid-column: 1 / -1; text-align: center; margin-top: 4px; }
    .calc-grid .half { grid-column: span 2; }
    
    /* ë¬´ê³µ í‘œì‹œ */
    .skill-display {
      background: rgba(155,89,182,0.1);
      border: 1px solid rgba(155,89,182,0.3);
      border-radius: 6px;
      padding: 8px;
      margin-top: 8px;
    }
    
    .skill-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
    }
    
    .skill-name { color: #9b59b6; font-weight: bold; }
    .skill-stats { color: #aaa; }
    
    /* ì „íˆ¬ ì˜ì—­ */
    .battle-section {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .battle-controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .btn {
      padding: 10px 20px;
      font-size: 0.9rem;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn:hover { transform: scale(1.03); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    
    .btn-battle {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      color: #fff;
    }
    
    .btn-auto {
      background: linear-gradient(135deg, #f39c12 0%, #d68910 100%);
      color: #fff;
    }
    
    .btn-reset {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: #aaa;
    }
    
    .btn-stop {
      background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
      color: #fff;
    }
    
    .battle-log-container {
      flex: 1;
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      min-height: 450px;
      max-height: 650px;
    }
    
    .log-header {
      padding: 10px 14px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .log-header h3 {
      color: #ffd700;
      font-family: 'Noto Serif KR', serif;
      font-size: 1rem;
    }
    
    .round-counter {
      background: rgba(255,215,0,0.2);
      padding: 3px 10px;
      border-radius: 10px;
      font-size: 0.8rem;
      color: #ffd700;
    }
    
    .log-content {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      font-family: 'D2Coding', monospace, sans-serif;
      font-size: 0.8rem;
      line-height: 1.5;
    }
    
    .log-line { margin-bottom: 2px; color: #bbb; }
    .log-line.title { color: #ffd700; font-weight: bold; }
    .log-line.danger { color: #e74c3c; }
    .log-line.warning { color: #f39c12; }
    .log-line.success { color: #2ecc71; }
    .log-line.info { color: #3498db; }
    .log-line.skill { color: #9b59b6; }
    .log-line.divider { color: #555; }
    .log-line.round-title { 
      color: #fff; 
      background: rgba(255,255,255,0.1); 
      padding: 3px 6px; 
      border-radius: 3px;
      margin: 6px 0;
    }
    
    .battle-result {
      padding: 12px;
      border-top: 1px solid rgba(255,255,255,0.1);
      text-align: center;
    }
    
    .result-text { font-family: 'Noto Serif KR', serif; font-size: 1.2rem; }
    .result-winner { color: #ffd700; }
    .result-draw { color: #9b59b6; }
    
    .flee-warning {
      background: rgba(243,156,18,0.2);
      border: 1px solid rgba(243,156,18,0.5);
      border-radius: 6px;
      padding: 8px;
      margin-top: 6px;
      text-align: center;
      font-size: 0.85rem;
      color: #f39c12;
    }
    
    footer {
      text-align: center;
      margin-top: 20px;
      color: #555;
      font-size: 0.75rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>S-Engine æˆ°é¬ª è©¦æ¼”å™¨</h1>
      <p class="subtitle">ë¬´í˜‘ ì„¸ê³„ê´€ ì „íˆ¬ ì‹œë®¬ë ˆì´í„° v3.0 - ë¬´ê³µ ì‹œìŠ¤í…œ</p>
    </header>
    
    <div class="main-layout">
      <!-- ì¢Œì¸¡: ìºë¦­í„° ì„¤ì • -->
      <div class="panels">
        <!-- ê³µê²©ì íŒ¨ë„ -->
        <div class="panel attacker">
          <h2>âš”ï¸ ê³µê²©ì</h2>
          
          <div class="form-row">
            <div class="form-group">
              <label>ì´ë¦„</label>
              <input type="text" id="atk-name" value="ê²€í˜¸">
            </div>
            <div class="form-group">
              <label>ê²½ì§€ <span class="highlight-red" id="atk-gyeongji-label">çµ¶é ‚</span></label>
              <select id="atk-gyeongji" onchange="onGyeongjiChange('atk')">
                <option value="ì‚¼ë¥˜">ì‚¼ë¥˜ (ä¸‰æµ)</option>
                <option value="ì´ë¥˜">ì´ë¥˜ (äºŒæµ)</option>
                <option value="ì¼ë¥˜">ì¼ë¥˜ (ä¸€æµ)</option>
                <option value="ì ˆì •" selected>ì ˆì • (çµ¶é ‚)</option>
                <option value="ì´ˆì ˆì •">ì´ˆì ˆì • (è¶…çµ¶é ‚)</option>
                <option value="í™”ê²½">í™”ê²½ (åŒ–å¢ƒ)</option>
                <option value="í˜„ê²½">í˜„ê²½ (ç„å¢ƒ)</option>
                <option value="ìƒì‚¬ê²½">ìƒì‚¬ê²½ (ç”Ÿæ­»å¢ƒ)</option>
                <option value="ìì—°ê²½">ìì—°ê²½ (è‡ªç„¶å¢ƒ)</option>
              </select>
            </div>
            <div class="form-group">
              <label>ì‹¬ë²•</label>
              <select id="atk-simbeop" onchange="updateAll()">
                <option value="ì‚¼ì¬ì‹¬ë²•">ì‚¼ì¬ì‹¬ë²•</option>
                <option value="ê¸°ì´ˆì‹¬ë²•">ê¸°ì´ˆì‹¬ë²•</option>
                <option value="ê¸°ë³¸ì‹¬ë²•" selected>ê¸°ë³¸ì‹¬ë²•</option>
                <option value="ì‹¬í™”ì‹¬ë²•">ì‹¬í™”ì‹¬ë²•</option>
                <option value="ë¹„ì „ì‹¬ë²•">ë¹„ì „ì‹¬ë²•</option>
                <option value="ëª…ìš´ì‹¬ë²•">ëª…ìš´ì‹¬ë²•</option>
                <option value="ë‹¬ë§ˆì‹¬ê³µ">ë‹¬ë§ˆì‹¬ê³µ</option>
                <option value="ì²œë§ˆì‹¬ê³µ">ì²œë§ˆì‹¬ê³µ</option>
              </select>
            </div>
            <div class="form-group">
              <label>ë³´ë²• <span class="highlight-gold" id="atk-bobeop-label">Lv5</span></label>
              <select id="atk-bobeop" onchange="updateAll()">
                <option value="0">ì—†ìŒ</option>
                <option value="1">ê¸°ì´ˆ 1ë‹¨ê³„</option>
                <option value="2">ê¸°ì´ˆ 2ë‹¨ê³„</option>
                <option value="3">ê¸°ì´ˆ 3ë‹¨ê³„</option>
                <option value="4">ê¸°ë³¸ 1ë‹¨ê³„</option>
                <option value="5" selected>ê¸°ë³¸ 2ë‹¨ê³„</option>
                <option value="6">ê¸°ë³¸ 3ë‹¨ê³„</option>
                <option value="7">ì‹¬í™” 1ë‹¨ê³„</option>
                <option value="8">ì‹¬í™” 2ë‹¨ê³„</option>
                <option value="9">ì‹¬í™” 3ë‹¨ê³„</option>
              </select>
            </div>
          </div>
          
          <div class="section-title">âš”ï¸ ë¬´ê³µ ì„¤ì •</div>
          <div class="form-row skills">
            <div class="form-group">
              <label>ë‚´ê³µë¬´ê³µ</label>
              <select id="atk-mugong" onchange="updateAll()">
                <option value="ê²€ê¸°">ê²€ê¸°</option>
                <option value="ê²€ì‚¬">ê²€ì‚¬</option>
                <option value="ê²€ê°•" selected>ê²€ê°•</option>
              </select>
            </div>
            <div class="form-group">
              <label>ìˆ™ë ¨ë„</label>
              <select id="atk-mugong-level" onchange="updateAll()">
                <option value="1">ä¸‹ (ì…ë¬¸)</option>
                <option value="2">ä¸­ (ìµìˆ™)</option>
                <option value="3" selected>ä¸Šä¸‹ (ëŠ¥ìˆ™)</option>
                <option value="4">ä¸Šä¸­ (ìˆ™ë ¨)</option>
                <option value="5">ä¸Šä¸Š (ì™„ìˆ™)</option>
              </select>
            </div>
            <div class="form-group">
              <label>ë°œì¶œê¸°</label>
              <select id="atk-balchul" onchange="updateAll()">
                <option value="ì—†ìŒ">ì—†ìŒ</option>
                <option value="ê²€ê¸°ë°œì¶œ">ê²€ê¸°ë°œì¶œ</option>
                <option value="ê²€ê¸°ì¦‰ì‹œë°œì¶œ">ê²€ê¸°ì¦‰ì‹œë°œì¶œ</option>
                <option value="ê²€ê°•ë°œì¶œ">ê²€ê°•ë°œì¶œ</option>
                <option value="ê²€ê°•ì¦‰ì‹œë°œì¶œ">ê²€ê°•ì¦‰ì‹œë°œì¶œ</option>
              </select>
            </div>
            <div class="form-group">
              <label>ë°œì¶œ ìˆ™ë ¨</label>
              <select id="atk-balchul-level" onchange="updateAll()">
                <option value="1" selected>ä¸‹</option>
                <option value="2">ä¸­</option>
                <option value="3">ä¸Šä¸‹</option>
                <option value="4">ä¸Šä¸­</option>
                <option value="5">ä¸Šä¸Š</option>
              </select>
            </div>
          </div>
          
          <div class="skill-display">
            <div class="skill-info">
              <span class="skill-name" id="atk-skill-name">ê²€ê°• ä¸Šä¸‹</span>
              <span class="skill-stats" id="atk-skill-stats">ê³µ/ë°© +23% | ë‚´ê³µì†Œë¹„ 3</span>
            </div>
          </div>
          
          <div class="form-row" style="margin-top: 10px;">
            <div class="form-group">
              <label>ìš´ê¸°ì§„í–‰ë„: <span id="atk-ungi-val">100</span>%</label>
              <input type="range" id="atk-ungi" min="80" max="100" value="100" 
                     style="accent-color: #e74c3c;" oninput="updateAll()">
            </div>
          </div>
          
          <div class="status-bars">
            <div class="status-bar">
              <div class="bar-label">
                <span>ì²´ë ¥</span>
                <span class="highlight-red" id="atk-hp-text">100 / 100</span>
              </div>
              <div class="bar-track">
                <div class="bar-fill hp" id="atk-hp-bar" style="width: 100%"></div>
              </div>
              <input type="range" id="atk-hp" min="1" max="100" value="100" 
                     style="accent-color: #e74c3c; margin-top: 3px;" oninput="updateAll()">
            </div>
            <div class="status-bar">
              <div class="bar-label">
                <span>ë‚´ê³µ</span>
                <span class="highlight-blue" id="atk-neigong-text">100 / 100</span>
              </div>
              <div class="bar-track">
                <div class="bar-fill neigong" id="atk-neigong-bar" style="width: 100%"></div>
              </div>
              <input type="range" id="atk-neigong" min="1" max="100" value="100" 
                     style="accent-color: #3498db; margin-top: 3px;" oninput="updateAll()">
            </div>
          </div>
          
          <div class="calc-result">
            <div class="calc-grid">
              <div>ìš´ê¸°ê²½ë¡œ: <span class="highlight-red" id="atk-calc-gyeongro">5.48</span></div>
              <div>ê³µê²©ì†ë„: <span class="highlight-red" id="atk-calc-speed">1.50</span>ì´ˆ</div>
              <div>ì´ë™ì†ë„: <span class="highlight-gold" id="atk-calc-move">âˆš5</span></div>
              <div>ì „íˆ¬ë¶ˆëŠ¥: <span class="highlight-red" id="atk-calc-threshold">40%</span></div>
              <div class="half">ë¬´ê³µ ë³´ì •: <span class="highlight-purple" id="atk-calc-mugong">+23%</span></div>
              <div class="half">ë³´ë²• ì¶”ê°€: <span class="highlight-gold" id="atk-calc-bobeop">+50%</span></div>
              <div class="full">
                ê¸°ë³¸íŒŒê´´ë ¥: <span class="highlight-red" id="atk-calc-power">5.48</span> â†’ 
                ìµœì¢…: <span class="highlight-gold" style="font-size:1rem;font-weight:bold" id="atk-calc-total">10.12</span>
                (ë‚´ê³µì†Œë¹„: <span class="highlight-blue" id="atk-calc-cost">3</span>)
              </div>
            </div>
          </div>
          
          <div class="flee-warning" id="atk-flee" style="display: none;">
            âš ï¸ ë„ì£¼ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤!
          </div>
        </div>
        
        <!-- ë°©ì–´ì íŒ¨ë„ -->
        <div class="panel defender">
          <h2>ğŸ›¡ï¸ ë°©ì–´ì</h2>
          
          <div class="form-row">
            <div class="form-group">
              <label>ì´ë¦„</label>
              <input type="text" id="def-name" value="ë„ì ">
            </div>
            <div class="form-group">
              <label>ê²½ì§€ <span class="highlight-blue" id="def-gyeongji-label">ä¸€æµ</span></label>
              <select id="def-gyeongji" onchange="onGyeongjiChange('def')">
                <option value="ì‚¼ë¥˜">ì‚¼ë¥˜ (ä¸‰æµ)</option>
                <option value="ì´ë¥˜">ì´ë¥˜ (äºŒæµ)</option>
                <option value="ì¼ë¥˜" selected>ì¼ë¥˜ (ä¸€æµ)</option>
                <option value="ì ˆì •">ì ˆì • (çµ¶é ‚)</option>
                <option value="ì´ˆì ˆì •">ì´ˆì ˆì • (è¶…çµ¶é ‚)</option>
                <option value="í™”ê²½">í™”ê²½ (åŒ–å¢ƒ)</option>
                <option value="í˜„ê²½">í˜„ê²½ (ç„å¢ƒ)</option>
                <option value="ìƒì‚¬ê²½">ìƒì‚¬ê²½ (ç”Ÿæ­»å¢ƒ)</option>
                <option value="ìì—°ê²½">ìì—°ê²½ (è‡ªç„¶å¢ƒ)</option>
              </select>
            </div>
            <div class="form-group">
              <label>ì‹¬ë²•</label>
              <select id="def-simbeop" onchange="updateAll()">
                <option value="ì‚¼ì¬ì‹¬ë²•">ì‚¼ì¬ì‹¬ë²•</option>
                <option value="ê¸°ì´ˆì‹¬ë²•" selected>ê¸°ì´ˆì‹¬ë²•</option>
                <option value="ê¸°ë³¸ì‹¬ë²•">ê¸°ë³¸ì‹¬ë²•</option>
                <option value="ì‹¬í™”ì‹¬ë²•">ì‹¬í™”ì‹¬ë²•</option>
                <option value="ë¹„ì „ì‹¬ë²•">ë¹„ì „ì‹¬ë²•</option>
                <option value="ëª…ìš´ì‹¬ë²•">ëª…ìš´ì‹¬ë²•</option>
                <option value="ë‹¬ë§ˆì‹¬ê³µ">ë‹¬ë§ˆì‹¬ê³µ</option>
                <option value="ì²œë§ˆì‹¬ê³µ">ì²œë§ˆì‹¬ê³µ</option>
              </select>
            </div>
            <div class="form-group">
              <label>ë³´ë²• <span class="highlight-gold" id="def-bobeop-label">Lv3</span></label>
              <select id="def-bobeop" onchange="updateAll()">
                <option value="0">ì—†ìŒ</option>
                <option value="1">ê¸°ì´ˆ 1ë‹¨ê³„</option>
                <option value="2">ê¸°ì´ˆ 2ë‹¨ê³„</option>
                <option value="3" selected>ê¸°ì´ˆ 3ë‹¨ê³„</option>
                <option value="4">ê¸°ë³¸ 1ë‹¨ê³„</option>
                <option value="5">ê¸°ë³¸ 2ë‹¨ê³„</option>
                <option value="6">ê¸°ë³¸ 3ë‹¨ê³„</option>
                <option value="7">ì‹¬í™” 1ë‹¨ê³„</option>
                <option value="8">ì‹¬í™” 2ë‹¨ê³„</option>
                <option value="9">ì‹¬í™” 3ë‹¨ê³„</option>
              </select>
            </div>
          </div>
          
          <div class="section-title">âš”ï¸ ë¬´ê³µ ì„¤ì •</div>
          <div class="form-row skills">
            <div class="form-group">
              <label>ë‚´ê³µë¬´ê³µ</label>
              <select id="def-mugong" onchange="updateAll()">
                <option value="ê²€ê¸°">ê²€ê¸°</option>
                <option value="ê²€ì‚¬" selected>ê²€ì‚¬</option>
                <option value="ê²€ê°•">ê²€ê°•</option>
              </select>
            </div>
            <div class="form-group">
              <label>ìˆ™ë ¨ë„</label>
              <select id="def-mugong-level" onchange="updateAll()">
                <option value="1">ä¸‹ (ì…ë¬¸)</option>
                <option value="2" selected>ä¸­ (ìµìˆ™)</option>
                <option value="3">ä¸Šä¸‹ (ëŠ¥ìˆ™)</option>
                <option value="4">ä¸Šä¸­ (ìˆ™ë ¨)</option>
                <option value="5">ä¸Šä¸Š (ì™„ìˆ™)</option>
              </select>
            </div>
            <div class="form-group">
              <label>ë°œì¶œê¸°</label>
              <select id="def-balchul" onchange="updateAll()">
                <option value="ì—†ìŒ" selected>ì—†ìŒ</option>
                <option value="ê²€ê¸°ë°œì¶œ">ê²€ê¸°ë°œì¶œ</option>
                <option value="ê²€ê¸°ì¦‰ì‹œë°œì¶œ">ê²€ê¸°ì¦‰ì‹œë°œì¶œ</option>
                <option value="ê²€ê°•ë°œì¶œ">ê²€ê°•ë°œì¶œ</option>
                <option value="ê²€ê°•ì¦‰ì‹œë°œì¶œ">ê²€ê°•ì¦‰ì‹œë°œì¶œ</option>
              </select>
            </div>
            <div class="form-group">
              <label>ë°œì¶œ ìˆ™ë ¨</label>
              <select id="def-balchul-level" onchange="updateAll()">
                <option value="1" selected>ä¸‹</option>
                <option value="2">ä¸­</option>
                <option value="3">ä¸Šä¸‹</option>
                <option value="4">ä¸Šä¸­</option>
                <option value="5">ä¸Šä¸Š</option>
              </select>
            </div>
          </div>
          
          <div class="skill-display">
            <div class="skill-info">
              <span class="skill-name" id="def-skill-name">ê²€ì‚¬ ä¸­</span>
              <span class="skill-stats" id="def-skill-stats">ê³µ/ë°© +9% | ë‚´ê³µì†Œë¹„ 2</span>
            </div>
          </div>
          
          <div class="form-row" style="margin-top: 10px;">
            <div class="form-group">
              <label>ìš´ê¸°ì§„í–‰ë„: <span id="def-ungi-val">90</span>%</label>
              <input type="range" id="def-ungi" min="80" max="100" value="90" 
                     style="accent-color: #3498db;" oninput="updateAll()">
            </div>
          </div>
          
          <div class="status-bars">
            <div class="status-bar">
              <div class="bar-label">
                <span>ì²´ë ¥</span>
                <span class="highlight-red" id="def-hp-text">100 / 100</span>
              </div>
              <div class="bar-track">
                <div class="bar-fill hp" id="def-hp-bar" style="width: 100%"></div>
              </div>
              <input type="range" id="def-hp" min="1" max="100" value="100" 
                     style="accent-color: #e74c3c; margin-top: 3px;" oninput="updateAll()">
            </div>
            <div class="status-bar">
              <div class="bar-label">
                <span>ë‚´ê³µ</span>
                <span class="highlight-blue" id="def-neigong-text">100 / 100</span>
              </div>
              <div class="bar-track">
                <div class="bar-fill neigong" id="def-neigong-bar" style="width: 100%"></div>
              </div>
              <input type="range" id="def-neigong" min="1" max="100" value="100" 
                     style="accent-color: #3498db; margin-top: 3px;" oninput="updateAll()">
            </div>
          </div>
          
          <div class="calc-result">
            <div class="calc-grid">
              <div>ìš´ê¸°ê²½ë¡œ: <span class="highlight-blue" id="def-calc-gyeongro">4.47</span></div>
              <div>ê³µê²©ì†ë„: <span class="highlight-blue" id="def-calc-speed">1.73</span>ì´ˆ</div>
              <div>ì´ë™ì†ë„: <span class="highlight-gold" id="def-calc-move">âˆš3</span></div>
              <div>ì „íˆ¬ë¶ˆëŠ¥: <span class="highlight-blue" id="def-calc-threshold">40%</span></div>
              <div class="half">ë¬´ê³µ ë³´ì •: <span class="highlight-purple" id="def-calc-mugong">+9%</span></div>
              <div class="half">ë³´ë²• ì¶”ê°€: <span class="highlight-gold" id="def-calc-bobeop">+30%</span></div>
              <div class="full">
                ê¸°ë³¸íŒŒê´´ë ¥: <span class="highlight-blue" id="def-calc-power">4.02</span> â†’ 
                ìµœì¢…: <span class="highlight-gold" style="font-size:1rem;font-weight:bold" id="def-calc-total">5.70</span>
                (ë‚´ê³µì†Œë¹„: <span class="highlight-blue" id="def-calc-cost">2</span>)
              </div>
            </div>
          </div>
          
          <div class="flee-warning" id="def-flee" style="display: none;">
            âš ï¸ ë„ì£¼ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤!
          </div>
        </div>
      </div>
      
      <!-- ìš°ì¸¡: ì „íˆ¬ ë¡œê·¸ -->
      <div class="battle-section">
        <div class="battle-controls">
          <button class="btn btn-battle" onclick="executeOneRound()">âš”ï¸ 1í•©</button>
          <button class="btn btn-auto" id="btn-auto" onclick="startAutoBattle()">ğŸ”„ ìë™</button>
          <button class="btn btn-stop" id="btn-stop" onclick="stopAutoBattle()" style="display:none;">â¹ï¸ ì¤‘ì§€</button>
          <button class="btn btn-reset" onclick="resetBattle()">â†º ì´ˆê¸°í™”</button>
        </div>
        
        <div class="battle-log-container">
          <div class="log-header">
            <h3>ğŸ“œ ì „íˆ¬ ê¸°ë¡</h3>
            <div class="round-counter">ì œ <span id="round-num">0</span> í•©</div>
          </div>
          <div class="log-content" id="log-content">
            <div class="log-line info">ì „íˆ¬ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>
          </div>
          <div class="battle-result" id="battle-result" style="display: none;">
            <div class="result-text" id="result-text"></div>
          </div>
        </div>
      </div>
    </div>
    
    <footer>
      S-Engine Combat Simulator v3.0 by ShadowK | ê°œë°œìš© ì‹œë®¬ë ˆì´í„°
    </footer>
  </div>
  
  <script>
    // ===== ë°ì´í„° ì •ì˜ =====
    const GYEONGJI_DATA = {
      'ì‚¼ë¥˜': { level: 1, attackSpeed: Math.sqrt(1), label: 'ä¸‰æµ', maxBobeop: 2 },
      'ì´ë¥˜': { level: 2, attackSpeed: Math.sqrt(2), label: 'äºŒæµ', maxBobeop: 3 },
      'ì¼ë¥˜': { level: 3, attackSpeed: Math.sqrt(3), label: 'ä¸€æµ', maxBobeop: 4 },
      'ì ˆì •': { level: 4, attackSpeed: Math.sqrt(4), label: 'çµ¶é ‚', maxBobeop: 5 },
      'ì´ˆì ˆì •': { level: 5, attackSpeed: Math.sqrt(5), label: 'è¶…çµ¶é ‚', maxBobeop: 6 },
      'í™”ê²½': { level: 6, attackSpeed: Math.sqrt(6), label: 'åŒ–å¢ƒ', maxBobeop: 7 },
      'í˜„ê²½': { level: 7, attackSpeed: Math.sqrt(7), label: 'ç„å¢ƒ', maxBobeop: 8 },
      'ìƒì‚¬ê²½': { level: 8, attackSpeed: Math.sqrt(8), label: 'ç”Ÿæ­»å¢ƒ', maxBobeop: 9 },
      'ìì—°ê²½': { level: 9, attackSpeed: Math.sqrt(9), label: 'è‡ªç„¶å¢ƒ', maxBobeop: 10 }
    };
    
    const SIMBEOP_DATA = {
      'ì‚¼ì¬ì‹¬ë²•': { chukgi: 10, stability: 90, total: 100, type: 'ê¸°ë³¸' },
      'ê¸°ì´ˆì‹¬ë²•': { chukgi: 20, stability: 80, total: 100, type: 'ê¸°ì´ˆ' },
      'ê¸°ë³¸ì‹¬ë²•': { chukgi: 30, stability: 70, total: 100, type: 'ê¸°ë³¸' },
      'ì‹¬í™”ì‹¬ë²•': { chukgi: 40, stability: 70, total: 110, type: 'ì‹¬í™”' },
      'ë¹„ì „ì‹¬ë²•': { chukgi: 70, stability: 60, total: 130, type: 'ë¹„ì „' },
      'ëª…ìš´ì‹¬ë²•': { chukgi: 110, stability: 80, total: 190, type: 'ì‹ ê³µLv1' },
      'ë‹¬ë§ˆì‹¬ê³µ': { chukgi: 120, stability: 80, total: 200, type: 'ì‹ ê³µLv2' },
      'ì²œë§ˆì‹¬ê³µ': { chukgi: 130, stability: 70, total: 200, type: 'ì‹ ê³µLv2' }
    };
    
    const COMBAT_DISABLE = {
      'ê¸°ì´ˆ': 40, 'ê¸°ë³¸': 40, 'ì‹¬í™”': 40,
      'ë¹„ì „': 35, 'ì‹ ê³µLv1': 30, 'ì‹ ê³µLv2': 25
    };
    
    // ë¬´ê³µ ë°ì´í„°: [ê³µë°©ë³´ì •%, ë‚´ê³µì†Œë¹„]
    const MUGONG_DATA = {
      'ê²€ê¸°': {
        1: [2, 1], 2: [4, 1], 3: [6, 1], 4: [8, 1], 5: [10, 1],
        6: [12, 1], 7: [14, 1], 8: [16, 1]  // í™”ê²½+
      },
      'ê²€ì‚¬': {
        1: [6, 2], 2: [9, 2], 3: [12, 2], 4: [15, 2], 5: [18, 2],
        6: [21, 2], 7: [24, 2]
      },
      'ê²€ê°•': {
        1: [15, 3], 2: [19, 3], 3: [23, 3], 4: [28, 3], 5: [33, 3]
      }
    };
    
    // ë°œì¶œê¸° ë°ì´í„°
    const BALCHUL_DATA = {
      'ê²€ê¸°ë°œì¶œ': {
        1: [6, 2], 2: [8, 2], 3: [10, 2], 4: [12, 2], 5: [14, 2], 6: [16, 2]
      },
      'ê²€ê¸°ì¦‰ì‹œë°œì¶œ': {
        1: [6, 2], 2: [8, 2], 3: [10, 2], 4: [12, 2], 5: [14, 2], 6: [16, 2]
      },
      'ê²€ê°•ë°œì¶œ': {
        1: [15, 4], 2: [19, 4], 3: [23, 4], 4: [28, 4], 5: [33, 4]
      },
      'ê²€ê°•ì¦‰ì‹œë°œì¶œ': {
        1: [18, 4], 2: [23, 4], 3: [28, 4], 4: [28, 4]
      }
    };
    
    // ê²½ì§€ë³„ ìŠµë“ ê°€ëŠ¥ ë¬´ê³µ
    const MUGONG_REQUIREMENTS = {
      'ê²€ê¸°': 1, 'ê²€ì‚¬': 2, 'ê²€ê°•': 4,
      'ê²€ê¸°ë°œì¶œ': 3, 'ê²€ê¸°ì¦‰ì‹œë°œì¶œ': 4,
      'ê²€ê°•ë°œì¶œ': 5, 'ê²€ê°•ì¦‰ì‹œë°œì¶œ': 6
    };
    
    const LEVEL_NAMES = ['', 'ä¸‹', 'ä¸­', 'ä¸Šä¸‹', 'ä¸Šä¸­', 'ä¸Šä¸Š', 'ä¸Šä¸Š', 'ä¸Šä¸Š', 'ä¸Šä¸Š'];
    const FLEE_THRESHOLD_BONUS = 15;
    
    // ===== ì „íˆ¬ ìƒíƒœ =====
    let battleState = {
      round: 0,
      isRunning: false,
      autoInterval: null,
      attacker: { hp: 100, neigong: 100 },
      defender: { hp: 100, neigong: 100 },
      winner: null
    };
    
    // ===== ë¬´ê³µ ê³„ì‚° =====
    function getMugongStats(mugong, level, balchul, balchulLevel) {
      let bonus = 0, cost = 0, skillName = '';
      
      // ê¸°ë³¸ ë¬´ê³µ
      const mugongData = MUGONG_DATA[mugong];
      if (mugongData && mugongData[level]) {
        bonus = mugongData[level][0];
        cost = mugongData[level][1];
        skillName = `${mugong} ${LEVEL_NAMES[level]}`;
      }
      
      // ë°œì¶œê¸° (ë°œì¶œê¸° ì‚¬ìš©ì‹œ ë°œì¶œê¸° ìŠ¤íƒ¯ìœ¼ë¡œ ëŒ€ì²´)
      if (balchul !== 'ì—†ìŒ') {
        const balchulData = BALCHUL_DATA[balchul];
        if (balchulData && balchulData[balchulLevel]) {
          bonus = balchulData[balchulLevel][0];
          cost += balchulData[balchulLevel][1]; // ë°œì¶œê¸°ëŠ” ì¶”ê°€ ë‚´ê³µ ì†Œë¹„
          skillName += ` â†’ ${balchul} ${LEVEL_NAMES[balchulLevel]}`;
        }
      }
      
      return { bonus, cost, skillName };
    }
    
    // ê²½ì§€ ë³€ê²½ì‹œ ë¬´ê³µ ì˜µì…˜ ê°±ì‹ 
    function onGyeongjiChange(prefix) {
      const gyeongji = document.getElementById(`${prefix}-gyeongji`).value;
      const level = GYEONGJI_DATA[gyeongji].level;
      
      // ë¬´ê³µ ì˜µì…˜ í•„í„°ë§
      const mugongSelect = document.getElementById(`${prefix}-mugong`);
      const balchulSelect = document.getElementById(`${prefix}-balchul`);
      
      // ë¬´ê³µ
      for (let opt of mugongSelect.options) {
        const req = MUGONG_REQUIREMENTS[opt.value] || 1;
        opt.disabled = level < req;
        if (opt.disabled && opt.selected) {
          mugongSelect.value = 'ê²€ê¸°';
        }
      }
      
      // ë°œì¶œê¸°
      for (let opt of balchulSelect.options) {
        if (opt.value === 'ì—†ìŒ') continue;
        const req = MUGONG_REQUIREMENTS[opt.value] || 1;
        opt.disabled = level < req;
        if (opt.disabled && opt.selected) {
          balchulSelect.value = 'ì—†ìŒ';
        }
      }
      
      updateAll();
    }
    
    // ===== ê³„ì‚° í•¨ìˆ˜ =====
    function getCharData(prefix) {
      const gyeongji = document.getElementById(`${prefix}-gyeongji`).value;
      const simbeop = document.getElementById(`${prefix}-simbeop`).value;
      const bobeop = parseInt(document.getElementById(`${prefix}-bobeop`).value);
      const mugong = document.getElementById(`${prefix}-mugong`).value;
      const mugongLevel = parseInt(document.getElementById(`${prefix}-mugong-level`).value);
      const balchul = document.getElementById(`${prefix}-balchul`).value;
      const balchulLevel = parseInt(document.getElementById(`${prefix}-balchul-level`).value);
      const ungi = parseInt(document.getElementById(`${prefix}-ungi`).value);
      
      const stateKey = prefix === 'atk' ? 'attacker' : 'defender';
      const hp = battleState.round > 0 ? battleState[stateKey].hp : parseInt(document.getElementById(`${prefix}-hp`).value);
      const neigong = battleState.round > 0 ? battleState[stateKey].neigong : parseInt(document.getElementById(`${prefix}-neigong`).value);
      
      const g = GYEONGJI_DATA[gyeongji];
      const s = SIMBEOP_DATA[simbeop];
      
      // ê¸°ë³¸ ê³„ì‚°
      const ungiGyeongro = Math.sqrt(s.chukgi);
      const danger = 1 / Math.sqrt(s.stability);
      const ungiRemain = 100 - ungi;
      const baseAttackTime = 3 / g.attackSpeed;
      
      // ì†ë„ ë³´ì •
      let speedMod = 1;
      if (neigong < 70) speedMod -= (70 - neigong) * 0.03;
      const attackTime = baseAttackTime / Math.max(speedMod, 0.1);
      
      // ì´ë™ì†ë„ & ë³´ë²• ë³´ë„ˆìŠ¤
      const moveSpeed = bobeop > 0 ? Math.sqrt(bobeop) : 1;
      const bobeopBonus = bobeop * 0.1;
      
      // ë¬´ê³µ ìŠ¤íƒ¯
      const mugongStats = getMugongStats(mugong, mugongLevel, balchul, balchulLevel);
      const mugongBonus = mugongStats.bonus / 100;
      const neigongCost = mugongStats.cost;
      
      // ë‚´ê³µíŒŒê´´ë ¥
      let basePower = ungiGyeongro * (ungi / 100);
      if (hp < 80) basePower *= (1 - (80 - hp) * 0.03);
      
      // ìµœì¢… íŒŒê´´ë ¥ = ê¸°ë³¸ Ã— (1 + ë¬´ê³µë³´ì •) Ã— (1 + ë³´ë²•ë³´ì •)
      const totalPower = basePower * (1 + mugongBonus) * (1 + bobeopBonus);
      
      // ì „íˆ¬ë¶ˆëŠ¥ ì„ê³„ê°’
      const threshold = COMBAT_DISABLE[s.type];
      const shouldFlee = neigong <= (threshold + FLEE_THRESHOLD_BONUS);
      
      return {
        name: document.getElementById(`${prefix}-name`).value,
        gyeongji, simbeop, bobeop, mugong, mugongLevel, balchul, balchulLevel,
        ungi, hp, neigong, g, s, ungiGyeongro, danger, ungiRemain, attackTime,
        moveSpeed, bobeopBonus, mugongBonus, mugongStats, neigongCost,
        basePower, totalPower, threshold, shouldFlee, speedMod
      };
    }
    
    function updateDisplay(prefix) {
      const data = getCharData(prefix);
      const stateKey = prefix === 'atk' ? 'attacker' : 'defender';
      const state = battleState[stateKey];
      
      // ë¼ë²¨
      document.getElementById(`${prefix}-gyeongji-label`).textContent = data.g.label;
      document.getElementById(`${prefix}-bobeop-label`).textContent = data.bobeop > 0 ? `Lv${data.bobeop}` : 'ì—†ìŒ';
      document.getElementById(`${prefix}-ungi-val`).textContent = data.ungi;
      
      // ë¬´ê³µ í‘œì‹œ
      document.getElementById(`${prefix}-skill-name`).textContent = data.mugongStats.skillName || `${data.mugong} ${LEVEL_NAMES[data.mugongLevel]}`;
      document.getElementById(`${prefix}-skill-stats`).textContent = 
        `ê³µ/ë°© +${(data.mugongBonus * 100).toFixed(0)}% | ë‚´ê³µì†Œë¹„ ${data.neigongCost}`;
      
      // HP/ë‚´ê³µ ë°”
      const displayHp = battleState.round > 0 ? state.hp : data.hp;
      const displayNeigong = battleState.round > 0 ? state.neigong : data.neigong;
      
      document.getElementById(`${prefix}-hp-text`).textContent = `${displayHp.toFixed(1)} / 100`;
      document.getElementById(`${prefix}-hp-bar`).style.width = `${Math.max(0, displayHp)}%`;
      document.getElementById(`${prefix}-neigong-text`).textContent = `${displayNeigong.toFixed(1)} / 100`;
      document.getElementById(`${prefix}-neigong-bar`).style.width = `${Math.max(0, displayNeigong)}%`;
      
      // ê³„ì‚° ê²°ê³¼
      document.getElementById(`${prefix}-calc-gyeongro`).textContent = data.ungiGyeongro.toFixed(2);
      document.getElementById(`${prefix}-calc-speed`).textContent = data.attackTime.toFixed(2);
      document.getElementById(`${prefix}-calc-move`).textContent = `âˆš${data.bobeop || 1}`;
      document.getElementById(`${prefix}-calc-threshold`).textContent = `${data.threshold}%`;
      document.getElementById(`${prefix}-calc-mugong`).textContent = `+${(data.mugongBonus * 100).toFixed(0)}%`;
      document.getElementById(`${prefix}-calc-bobeop`).textContent = `+${(data.bobeopBonus * 100).toFixed(0)}%`;
      document.getElementById(`${prefix}-calc-power`).textContent = data.basePower.toFixed(2);
      document.getElementById(`${prefix}-calc-total`).textContent = data.totalPower.toFixed(2);
      document.getElementById(`${prefix}-calc-cost`).textContent = data.neigongCost;
      
      // ë„ì£¼ ê¶Œì¥
      const fleeEl = document.getElementById(`${prefix}-flee`);
      fleeEl.style.display = (data.shouldFlee && battleState.round > 0) ? 'block' : 'none';
    }
    
    function updateAll() {
      updateDisplay('atk');
      updateDisplay('def');
    }
    
    // ===== ì „íˆ¬ ë¡œì§ =====
    function addLog(text, className = '') {
      const content = document.getElementById('log-content');
      const line = document.createElement('div');
      line.className = `log-line ${className}`;
      line.textContent = text;
      content.appendChild(line);
      content.scrollTop = content.scrollHeight;
    }
    
    function executeOneRound() {
      if (battleState.winner) return;
      
      battleState.round++;
      document.getElementById('round-num').textContent = battleState.round;
      
      if (battleState.round === 1) {
        battleState.attacker.hp = parseFloat(document.getElementById('atk-hp').value);
        battleState.attacker.neigong = parseFloat(document.getElementById('atk-neigong').value);
        battleState.defender.hp = parseFloat(document.getElementById('def-hp').value);
        battleState.defender.neigong = parseFloat(document.getElementById('def-neigong').value);
        document.getElementById('log-content').innerHTML = '';
      }
      
      const atk = getCharData('atk');
      const def = getCharData('def');
      
      addLog(`â•â•â•â•â•â• ì œ ${battleState.round} í•© â•â•â•â•â•â•`, 'round-title');
      
      // ì„ ê³µ ê²°ì •
      let first, second;
      if (atk.moveSpeed > def.moveSpeed) {
        first = { ...atk, prefix: 'atk', state: battleState.attacker };
        second = { ...def, prefix: 'def', state: battleState.defender };
      } else if (def.moveSpeed > atk.moveSpeed) {
        first = { ...def, prefix: 'def', state: battleState.defender };
        second = { ...atk, prefix: 'atk', state: battleState.attacker };
      } else {
        if (atk.attackTime <= def.attackTime) {
          first = { ...atk, prefix: 'atk', state: battleState.attacker };
          second = { ...def, prefix: 'def', state: battleState.defender };
        } else {
          first = { ...def, prefix: 'def', state: battleState.defender };
          second = { ...atk, prefix: 'atk', state: battleState.attacker };
        }
      }
      
      addLog(`ì„ ê³µ: ${first.name} (${first.mugongStats.skillName})`, 'info');
      
      // ë³´ì • ê³„ì‚°
      const gyeongjiDiff = first.g.level - second.g.level;
      let firstMod = 1, secondMod = 1;
      
      if (gyeongjiDiff > 0) secondMod -= gyeongjiDiff * 0.03;
      else if (gyeongjiDiff < 0) firstMod += gyeongjiDiff * 0.03;
      
      if (first.s.total > second.s.total) secondMod -= 0.03;
      else if (first.s.total < second.s.total) firstMod -= 0.03;
      
      // ì²« ë²ˆì§¸ ê³µê²©
      processAttack(first, second, firstMod);
      
      if (!checkCombatDisable(second)) {
        processAttack(second, first, secondMod);
        checkCombatDisable(first);
      }
      
      // ìƒì‚¬ê²½/ìì—°ê²½ ë‚´ê³µ í¡ìˆ˜
      processNeigongDrain(atk, def);
      
      updateAll();
      checkWinner();
    }
    
    function processAttack(attacker, defender, mod) {
      // ë‚´ê³µ ì†Œë¹„ ì²´í¬
      if (attacker.state.neigong < attacker.neigongCost) {
        addLog(`${attacker.name}: ë‚´ê³µ ë¶€ì¡±! (í•„ìš”: ${attacker.neigongCost}, í˜„ì¬: ${attacker.state.neigong.toFixed(1)})`, 'warning');
        return;
      }
      
      // ë‚´ê³µ ì†Œë¹„
      attacker.state.neigong -= attacker.neigongCost;
      
      // ëª…ì¤‘ë¥  ì²´í¬
      let hitChance = 100;
      if (attacker.state.neigong <= 50) {
        hitChance = 95 - (50 - attacker.state.neigong) * 5;
        hitChance = Math.max(hitChance, 5);
      }
      
      const isHit = Math.random() * 100 < hitChance;
      
      if (!isHit) {
        addLog(`${attacker.name}ì˜ ê³µê²©ì´ ë¹—ë‚˜ê°”ë‹¤! (ëª…ì¤‘ë¥ : ${hitChance.toFixed(0)}%)`, 'warning');
        const selfDamage = attacker.ungiRemain * attacker.danger;
        attacker.state.hp -= selfDamage * 0.1;
        attacker.state.neigong -= selfDamage * 0.9;
        return;
      }
      
      // í”¼í•´ ê³„ì‚°
      const baseDamage = attacker.totalPower * 10 * mod;
      const hpDamage = baseDamage * 0.2;
      const neigongDamage = baseDamage * 0.8;
      
      defender.state.hp -= hpDamage;
      defender.state.neigong -= neigongDamage;
      
      addLog(`${attacker.name} [${attacker.mugong}${attacker.balchul !== 'ì—†ìŒ' ? '+' + attacker.balchul : ''}] â†’ ${defender.name}`, 'skill');
      addLog(`  í”¼í•´: ì²´ë ¥ -${hpDamage.toFixed(2)}, ë‚´ê³µ -${neigongDamage.toFixed(2)} (ì†Œë¹„: ${attacker.neigongCost})`);
      
      // ìš´ê¸° ë‚´ìƒ
      const atkNaesang = attacker.ungiRemain * attacker.danger;
      const defNaesang = defender.ungiRemain * defender.danger;
      
      if (atkNaesang > 0.1) {
        attacker.state.hp -= atkNaesang * 0.1;
        attacker.state.neigong -= atkNaesang * 0.9;
        addLog(`  ${attacker.name} ìš´ê¸°ë‚´ìƒ: -${atkNaesang.toFixed(2)}`, 'warning');
      }
      
      if (defNaesang > 0.1) {
        defender.state.hp -= defNaesang * 0.1;
        defender.state.neigong -= defNaesang * 0.9;
        addLog(`  ${defender.name} ë°©ì–´ë‚´ìƒ: -${defNaesang.toFixed(2)}`, 'warning');
      }
      
      // ìµœì†Œê°’ ë³´ì •
      attacker.state.hp = Math.max(0, attacker.state.hp);
      attacker.state.neigong = Math.max(0, attacker.state.neigong);
      defender.state.hp = Math.max(0, defender.state.hp);
      defender.state.neigong = Math.max(0, defender.state.neigong);
    }
    
    function processNeigongDrain(atk, def) {
      const atkLevel = atk.g.level;
      const defLevel = def.g.level;
      
      if (atkLevel >= 8 && defLevel < atkLevel) {
        const rate = atkLevel === 9 ? 0.01 : 0.005;
        const drain = battleState.defender.neigong * rate;
        battleState.defender.neigong -= drain;
        battleState.attacker.neigong = Math.min(100, battleState.attacker.neigong + drain);
        addLog(`${atk.name} ë‚´ê³µí¡ìˆ˜: +${drain.toFixed(2)}`, 'success');
      }
      
      if (defLevel >= 8 && atkLevel < defLevel) {
        const rate = defLevel === 9 ? 0.01 : 0.005;
        const drain = battleState.attacker.neigong * rate;
        battleState.attacker.neigong -= drain;
        battleState.defender.neigong = Math.min(100, battleState.defender.neigong + drain);
        addLog(`${def.name} ë‚´ê³µí¡ìˆ˜: +${drain.toFixed(2)}`, 'success');
      }
    }
    
    function checkCombatDisable(char) {
      if (char.state.neigong <= char.threshold || char.state.hp <= 0) {
        addLog(`ğŸ’€ ${char.name} ì „íˆ¬ë¶ˆëŠ¥!`, 'danger');
        return true;
      }
      if (char.state.neigong <= char.threshold + FLEE_THRESHOLD_BONUS) {
        addLog(`âš ï¸ ${char.name}ì—ê²Œ ë„ì£¼ ê¶Œì¥!`, 'warning');
      }
      return false;
    }
    
    function checkWinner() {
      const atkData = getCharData('atk');
      const defData = getCharData('def');
      
      const atkDead = battleState.attacker.neigong <= atkData.threshold || battleState.attacker.hp <= 0;
      const defDead = battleState.defender.neigong <= defData.threshold || battleState.defender.hp <= 0;
      
      if (atkDead && defDead) {
        battleState.winner = 'draw';
        showResult('âš”ï¸ ìŒë°© ì „íˆ¬ë¶ˆëŠ¥!', 'result-draw');
      } else if (atkDead) {
        battleState.winner = 'defender';
        showResult(`ğŸ† ${defData.name} ìŠ¹ë¦¬! (${battleState.round}í•©)`, 'result-winner');
      } else if (defDead) {
        battleState.winner = 'attacker';
        showResult(`ğŸ† ${atkData.name} ìŠ¹ë¦¬! (${battleState.round}í•©)`, 'result-winner');
      }
      
      if (battleState.winner) stopAutoBattle();
    }
    
    function showResult(text, className) {
      document.getElementById('battle-result').style.display = 'block';
      const textEl = document.getElementById('result-text');
      textEl.className = `result-text ${className}`;
      textEl.textContent = text;
      addLog('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'divider');
      addLog(text, 'success');
    }
    
    function startAutoBattle() {
      if (battleState.winner) return;
      battleState.isRunning = true;
      document.getElementById('btn-auto').style.display = 'none';
      document.getElementById('btn-stop').style.display = 'inline-block';
      battleState.autoInterval = setInterval(() => {
        if (battleState.winner) { stopAutoBattle(); return; }
        executeOneRound();
      }, 600);
    }
    
    function stopAutoBattle() {
      battleState.isRunning = false;
      if (battleState.autoInterval) {
        clearInterval(battleState.autoInterval);
        battleState.autoInterval = null;
      }
      document.getElementById('btn-auto').style.display = 'inline-block';
      document.getElementById('btn-stop').style.display = 'none';
    }
    
    function resetBattle() {
      stopAutoBattle();
      battleState = {
        round: 0, isRunning: false, autoInterval: null,
        attacker: { hp: 100, neigong: 100 },
        defender: { hp: 100, neigong: 100 },
        winner: null
      };
      document.getElementById('atk-hp').value = 100;
      document.getElementById('atk-neigong').value = 100;
      document.getElementById('def-hp').value = 100;
      document.getElementById('def-neigong').value = 100;
      document.getElementById('round-num').textContent = '0';
      document.getElementById('log-content').innerHTML = '<div class="log-line info">ì „íˆ¬ë¥¼ ì‹œì‘í•˜ë ¤ë©´ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>';
      document.getElementById('battle-result').style.display = 'none';
      updateAll();
    }
    
    // ì´ˆê¸°í™”
    onGyeongjiChange('atk');
    onGyeongjiChange('def');
    updateAll();
  </script>
</body>
</html>
